---
layout: center
transition: blur-in
---

<ThemeTitle number="4" class="text-7xl! leading-20!">
<div>çµ„ä»¶çš„è¨˜æ†¶åŒ–</div>
<div>React.memo</div>
</ThemeTitle>

<!--
ä¸Šå€‹ç« ç¯€èªªåˆ°ï¼Œåªæœ‰ 3 ç¨®å ´æ™¯æ‰çœŸçš„éœ€è¦å»è¨˜æ†¶åŒ–å‡½æ•¸æˆ–ç‰©ä»¶ã€‚

å…¶ä¸­ä¸€å€‹å ´æ™¯å°±æ˜¯é€™å€‹ç« ç¯€çš„ä¸»é¡Œ â€” React.memoã€‚

æ‰€ä»¥é€™å€‹ç« ç¯€æœƒä¾†æ·±å…¥ React.memo ï¼Œä»‹ç´¹å®ƒçš„ç”¨æ³•ã€ä½¿ç”¨åŸå‰‡ä»¥åŠé™·é˜±ï¼Œé‚£æˆ‘å€‘å°±é–‹å§‹å§ï¼
-->

---

# `React.memo` æ˜¯ä»€éº¼ï¼Ÿ

<v-clicks>

1. React æä¾›çš„é«˜éšå…ƒä»¶ï¼ˆHigher-Order Componentï¼‰<span v-mark="{color: 'var(--secondary)', at: 1}">ï¼ˆç°¡å–®èªªå°±æ˜¯ä¸€å€‹å·¥å…·ï¼‰</span>
2. ä½œç”¨æ˜¯**è¨˜æ†¶åŒ–æ•´å€‹çµ„ä»¶**
3. æ ¹æ“š `Props` æ˜¯å¦æ”¹è®Šï¼Œä¾†æ±ºå®šæ˜¯å¦è·³é Re-render

</v-clicks>

<v-click>

ç•¶çˆ¶çµ„ä»¶é‡æ–°æ¸²æŸ“æ™‚ï¼Œ**`React.memo` æœƒæ¯”å°å‰å¾Œçš„ Props æ˜¯å¦ç›¸åŒã€‚**
<br/>
å¦‚æœ Props æ²’è®Šï¼Œé‚£å­çµ„ä»¶å°±æœƒç›´æ¥ä½¿ç”¨å‰ä¸€æ¬¡çš„ render çµæœï¼Œå®Œå…¨è·³éæ¸²æŸ“æµç¨‹ã€‚

</v-click>

<v-click>

```jsx
import { memo } from 'react';

function Child({ data }) {
  console.log('re-render', data);
  return <div>Child</div>;
}
const MemoChild = memo(Child);
```

```jsx
<MemoChild data={1} /> // re-render æ™‚ï¼Œæ¯”è¼ƒ prop: data å‰å¾Œå€¼æ˜¯å¦ç›¸åŒ
```

</v-click>

<!--
[click]
React.memoï¼ˆå¸¸ç°¡ç¨±ç‚º memoï¼‰æ˜¯ä¸€å€‹ React æä¾›çš„é«˜éšå…ƒçµ„ä»¶ï¼ˆHigher-Order Componentï¼‰ï¼Œç°¡å–®ä¾†èªªå®ƒå…¶å¯¦å°±æ˜¯ä¸€å€‹å·¥å…·å•¦ã€‚

[click]
å®ƒçš„ä½œç”¨æ˜¯è¨˜æ†¶åŒ–æ•´å€‹å…ƒä»¶çš„è¼¸å‡ºçµæœï¼Œ

[click]
è®“ React åœ¨æ¸²æŸ“æ™‚å¯ä»¥æ ¹æ“š Props æ˜¯å¦æ”¹è®Šï¼Œä¾†æ±ºå®šæ˜¯å¦è·³éé‡æ¸²æŸ“ã€‚

[click]
å…·é«”ä¾†èªªï¼šç•¶çˆ¶çµ„ä»¶é‡æ–°æ¸²æŸ“æ™‚ï¼ŒReact æœƒæ¯”å°è¢« React.memo åŒ…è£çš„çµ„ä»¶çš„ Props æ˜¯å¦ç›¸åŒã€‚

å¦‚æœ Props æ²’è®Šï¼Œé‚£é€™å€‹å­çµ„ä»¶å°±æœƒç›´æ¥ä½¿ç”¨å‰ä¸€æ¬¡çš„æ¸²æŸ“çµæœï¼Œå®Œå…¨è·³éæ¸²æŸ“æµç¨‹ï¼Œä¾†åšåˆ°æ•ˆèƒ½çš„å„ªåŒ–ã€‚

åä¹‹å¦‚æœ Props æ”¹è®Šäº†ï¼Œé‚£å­çµ„ä»¶å°±æœƒæ­£å¸¸åœ°è¢« Re-renderã€‚

[click]
å°±åƒä»¥ä¸‹ç¨‹å¼ç¢¼ï¼Œ å¦‚æœæˆ‘å€‘ä¸æƒ³è¦æ¯æ¬¡ Re-render éƒ½å°è‡´ Child é‡æ–°é‹ç®—ï¼Œå°±å¯ä»¥ä½¿ç”¨ React.memo ä¾†è¨˜æ†¶åŒ–æ•´å€‹çµ„ä»¶ï¼š

ç•¶çˆ¶çµ„ä»¶é‡æ–°æ¸²æŸ“æ™‚ï¼ŒReact æœƒæ¯”å°ç”¨æ¸²æŸ“å‰å¾Œï¼ŒMemoChild çš„ Props æ˜¯å¦ç›¸åŒã€‚
-->

---
layout: two-cols-header
hide: true
---

# ç¯„ä¾‹ä¸€ï¼šprops æ²’è®Šï¼ŒæˆåŠŸè·³éæ¸²æŸ“

::left::

````md magic-move
```jsx {*|2,7|8,12-18|8}
export default function Page() {
  const [count, setCount] = useState(0);
  console.log('parent re-render', count);

  return (
    <div>
      <button onClick={() => setCount(count + 1)}>Click me</button>
      <MemoChild data={1} />
    </div>
  );
}

function Child({ data }) {
  console.log('child re-render', data);
  return <div>Memo Child</div>;
}
const MemoChild = memo(Child);
```
````

::right::

<Video v-click mt-0>
  <source src="/ch-5/5-4/0.mp4" type="video/mp4" />
</Video>

<!--
æˆ‘å€‘çœ‹ä¸€å€‹ç°¡å–®çš„ä¾‹å­ï¼Œä¾†äº†è§£ `React.memo` çš„é‹ä½œæ–¹å¼ã€‚

[click]
é€é count ä¾†å¼·åˆ¶ re-render çˆ¶çµ„ä»¶

[click]
è§€å¯Ÿè¢« Memo çš„å­çµ„ä»¶æ˜¯å¦æœƒ re-renderã€‚

[click]
é€™è£¡åªå‚³ä¸€å€‹åŸå§‹å€¼ 1 çµ¦å­çµ„ä»¶ï¼Œæ‰€ä»¥å¯ä»¥é æœŸå› ç‚º props æ²’è®Šï¼Œå­çµ„ä»¶æœƒè·³é re-renderã€‚
-->

---
layout: two-cols-header
hide: true
---

# ç¯„ä¾‹äºŒï¼šprops æœ‰è®Šï¼Œå…ƒä»¶æ­£å¸¸ Re-render

::left::

````md magic-move
```jsx {*|8}
export default function Page() {
  const [count, setCount] = useState(0);
  console.log('parent re-render', count);

  return (
    <div>
      <Button onClick={() => setCount(count + 1)}>Click me</Button>
      <MemoChild data={1} count={count} />
    </div>
  );
}

function Child({ data, count }) {
  console.log('child re-render', data, count);
  return <div>Memo Child</div>;
}
const MemoChild = memo(Child);
```
````

::right::

<Video v-click mt-0>
  <source src="/ch-5/5-4/1.mp4" type="video/mp4" />
</Video>

<!--
ä¸éåªè¦æœ‰ä»»ä½•ä¸€å€‹ props æ”¹è®Šï¼ŒReact.memo å°±æœƒè®“è©²çµ„ä»¶é‡æ–°æ¸²æŸ“

[click]
ä¾‹å¦‚é€™é‚Šæˆ‘å€‘å‚³ count çµ¦ MemoChildï¼Œç•¶ count æ”¹è®Šæ™‚ï¼ŒMemoChild å°±æœƒé‡æ–°æ¸²æŸ“ã€‚

å¯ä»¥çœ‹åˆ°å½±ç‰‡é€™é‚Šï¼Œç•¶ count æ”¹è®Šæ™‚ï¼ŒMemoChild å°±æœƒé‡æ–°æ¸²æŸ“ã€‚
-->

---

# é‡å¯«ç¬¬ä¸€å€‹ç¯„ä¾‹

````md magic-move
```jsx
export default function UserProfile() {
  const [isDetailsVisible, setIsDetailsVisible] = useState(false);

  return (
    <div className="profile-container">
      <div className="user-header">
        <button onClick={() => setIsDetailsVisible(!isDetailsVisible)}>
          {isDetailsVisible ? 'Hide Details' : 'Show Details'}
        </button>

        {isDetailsVisible && (
          <UserDetails onHide={() => setIsDetailsVisible(false)} />
        )}
      </div>

      <AnalyticsComponent />
      <ChartComponent />
    </div>
  );
}
```

```jsx {1,3-4,13-14}
import { memo } from 'react';

const MemoAnalyticsComponent = memo(AnalyticsComponent);
const MemoChartComponent = memo(ChartComponent);

export default function UserProfile() {
  const [isDetailsVisible, setIsDetailsVisible] = useState(false);

  return (
    <div className="profile-container">
      <div className="user-header">{/* ... */}</div>

      <MemoAnalyticsComponent />
      <MemoChartComponent />
    </div>
  );
}
```

```jsx {13-14}
import { memo } from 'react';

const MemoAnalyticsComponent = memo(AnalyticsComponent);
const MemoChartComponent = memo(ChartComponent);

export default function UserProfile() {
  const [isDetailsVisible, setIsDetailsVisible] = useState(false);

  return (
    <div className="profile-container">
      <div className="user-header">{/* ... */}</div>

      <MemoAnalyticsComponent data={analyticsData} />
      <MemoChartComponent data={chartData} />
    </div>
  );
}
```
````

<!--
é‚„è¨˜å¾—ç‹€æ…‹ä¸‹ç§»ç« ç¯€çš„ç¯„ä¾‹å—ï¼Ÿ

åœ¨ç‹€æ…‹ä¸‹ç§»çš„ç« ç¯€ä¸­ï¼Œæˆ‘å€‘å„ªåŒ–äº†ä¸‹é¢çš„ç¨‹å¼ç¢¼ï¼Œå°‡ isDetailsVisibleã€buttonã€UserDetails å°è£æˆä¸€å€‹çµ„ä»¶ï¼Œé¿å… Re-render å…¶ä»–ç¹é‡çš„çµ„ä»¶ï¼š

[click]
é™¤äº†ç”¨ç‹€æ…‹ä¸‹ç§»ï¼Œæˆ‘å€‘é‚„èƒ½ä½¿ç”¨ React.memo ä¾†è¨˜æ†¶åŒ– AnalyticsComponent å’Œ ChartComponent

é€™æ¨£ç•¶ UserProfile é‡æ–°æ¸²æŸ“æ™‚ï¼Œç”±æ–¼ AnalyticsComponentå’Œ ChartComponent çš„ Props æ²’æœ‰æ”¹è®Šï¼Œæ‰€ä»¥å°±ä¸æœƒé‡æ–°æ¸²æŸ“ã€‚

[click]
ä¸éå¯¦å‹™ä¸Šï¼Œæˆ‘å€‘å¯èƒ½éœ€è¦å‚³å…¥ Props çµ¦ Memo çš„çµ„ä»¶

é‚£é€™å€‹æ™‚å€™ï¼Œæˆ‘å€‘å°±è¦ä¾†è¨è«–ä¸€å€‹éå¸¸å¸¸è¦‹çš„é™·é˜±ã€‚
-->

---

# ç‚ºä»€éº¼æœ‰æ™‚å€™ `React.memo` çœ‹èµ·ä¾†æ²’ç”¨ï¼Ÿ

````md magic-move
```jsx {*|8}
export default function Page() {
  const [count, setCount] = useState(0);
  console.log('parent re-render', count);

  return (
    <div>
      <Button onClick={() => setCount(count + 1)}>Click me</Button>
      <MemoChild data={{ a: 1 }} />
    </div>
  );
}

function Child({ data }) {
  console.log('re-render', data);
  return <div>Memo Child</div>;
}
const MemoChild = memo(Child);
```

```jsx
<MemoChild data={{ a: 1 }} />
// ç­‰åŒæ–¼ï¼š
const data = { a: 1 }
<MemoChild data={data} />
```
````

<v-click at="2">

æ¯æ¬¡ <span v-mark="{color: 'var(--secondary)', at: 2}">Re-render</span> æ™‚ï¼Œ**æ¯æ¬¡ Re-render æ™‚ï¼Œ ç‰©ä»¶éƒ½æœƒç”Ÿæˆä¸€å€‹æ–°çš„åƒè€ƒå€¼ã€‚**
<br/>
<br/>
å° React è€Œè¨€ï¼Œå°±ä»£è¡¨ Props æ”¹è®Šäº†ï¼Œæ–¼æ˜¯ `MemoChild` é‚„æ˜¯æœƒé‡æ–°æ¸²æŸ“ã€‚

</v-click>

<!--
ç‚ºä»€éº¼å¾ˆå¤šæ™‚å€™æˆ‘å€‘çš„ `React.memo` çœ‹èµ·ä¾†æ²’ç”¨ï¼Œè€Œä¸”æˆ‘å€‘åˆæ²’ç™¼ç¾å‘¢ï¼Ÿ

æˆ‘çœ‹éå¾ˆå¤šå·¥ç¨‹å¸«æ²’æœ‰æ³¨æ„åˆ°é€™ä»¶äº‹ï¼Œå°è‡´æ˜æ˜ç”¨äº† React.memoï¼Œå»ä¹Ÿæ²’ç™¼ç¾é€™å€‹ `React.memo` æ ¹æœ¬æ²’ç™¼æ®ä½œç”¨ã€‚

æˆ‘å€‘å…ˆä¾†çœ‹é€™å€‹ç¨‹å¼ç¢¼ï¼Œéå¸¸å–®ç´”ï¼Œä¸€å€‹ MemoChild å’Œä¸¦å‚³å…¥ä¸€å€‹ data Propsï¼ŒåŒæ™‚åœ¨çˆ¶çµ„ä»¶ Page æœ‰ä¸€å€‹ state æ§åˆ¶ Re-renderï¼š

[click]
å”¯ä¸€ç‰¹åˆ¥çš„åœ°æ–¹æ˜¯ï¼Œå‚³å…¥ MemoChild çš„ Props æ˜¯ä¸€å€‹ç‰©ä»¶ã€‚

[click]
é€™ç¨®æ™‚å€™å°±è¦æ³¨æ„äº†ï¼Œå°±åƒä¸Šå€‹ç« ç¯€èªªçš„ï¼Œå› ç‚ºæ¯æ¬¡ Re-render æ™‚ï¼Œ ç‰©ä»¶éƒ½æœƒç”Ÿæˆä¸€å€‹æ–°çš„åƒè€ƒå€¼ã€‚

é€™å° React è€Œè¨€ï¼Œå°±ä»£è¡¨ Props æ”¹è®Šäº†ï¼Œæ–¼æ˜¯ MemoChild é‚„æ˜¯æœƒé‡æ–°æ¸²æŸ“ã€‚
-->

---

# ä½¿ç”¨ `React.memo` çš„åŸå‰‡

### ä¸è¦åœ¨ Props ä¸­ç›´æ¥å‚³å…¥ inline çš„ç‰©ä»¶æˆ–å‡½æ•¸

````md magic-move
```jsx {*|7}
export default function Page() {
  const [count, setCount] = useState(0);
  console.log('parent re-render', count);

  return (
    <div>
      <MemoChild data={1} onClick={() => console.log('click')} />
      <button onClick={() => setCount(count + 1)}>Click me</button>
    </div>
  );
}
```
````

<!--
æ‰€ä»¥åœ¨ä½¿ç”¨ memo æ™‚ï¼Œæœ‰ä¸€å€‹éå¸¸é‡è¦çš„åŸå‰‡ï¼š

åƒè¬ä¸è¦åœ¨ Props ä¸­ç›´æ¥å‚³å…¥ inline çš„ç‰©ä»¶æˆ–å‡½æ•¸ï¼Œå°¤å…¶æ˜¯äº‹ä»¶è™•ç†å‡½æ•¸éå¸¸å®¹æ˜“è¢«é€™æ¨£èª¤ç”¨

ä¾†çœ‹ä¸€å€‹å¸¸è¦‹çš„éŒ¯èª¤å¯«æ³•ï¼š

[click]
åœ¨ MemoChild çš„ Props ä¸­ï¼Œæˆ‘å€‘å‚³çµ¦ onClick ä¸€å€‹ inline functionã€‚

é€™æœƒå°è‡´å„˜ç®¡ data={1} æ˜¯ç©©å®šçš„åŸå§‹å€¼ï¼Œä½† onClick={() => console.log('click')} æ¯æ¬¡éƒ½æ˜¯æ–°çš„å‡½æ•¸ã€æ–°çš„åƒè€ƒå€¼ã€‚

memo å°±æœƒåˆ¤æ–· Props æœ‰è®Šï¼Œè®“ MemoChild æ¯æ¬¡éƒ½è¢«é‡æ–°æ¸²æŸ“ï¼Œä¹Ÿå°±å®Œå…¨å¤±å»äº†è¨˜æ†¶åŒ–çš„æ•ˆæœäº†ã€‚
-->

---

# æ­é… `useMemo` æˆ– `useCallback` è¨˜æ†¶åŒ– Props

**`React.memo` é€šå¸¸éœ€è¦æ­é… `useMemo` æˆ– `useCallback` ä½¿ç”¨**ï¼Œä»¥ç¢ºä¿å‚³å…¥çš„ Props æ˜¯è¢«è¨˜æ†¶åŒ–çš„

```jsx {*|4-6,8,12}
export default function Page() {
  const [count, setCount] = useState(0);

  const onClick = useCallback(() => {
    setCount((prev) => prev + 1);
  }, []);

  const data = useMemo(() => ({ a: 1 }), []);

  return (
    <div>
      <MemoChild data={data} onClick={onClick} />
      <button onClick={onClick}>Click me</button>
    </div>
  );
}

function Child({ data, onClick }) {
  return <div onClick={onClick}>Child</div>;
}

const MemoChild = memo(Child);
```

<!--
å¯¦å‹™ä¸Šï¼ŒReact.memo é€šå¸¸éœ€è¦æ­é… `useMemo` æˆ– `useCallback` ä½¿ç”¨ï¼Œä»¥ç¢ºä¿å‚³å…¥çš„ props å…·æœ‰ç©©å®šçš„åƒè€ƒå€¼ï¼š

[click]
æ¯”å¦‚åœ¨é€™å€‹ä¾‹å­ä¸­ï¼ŒonClick èˆ‡ data éƒ½é€é useCallback å’Œ useMemo åšè¨˜æ†¶åŒ–ï¼Œå› æ­¤åœ¨ count æ”¹è®Šæ™‚ï¼Œå…©è€…çš„åƒè€ƒå€¼éƒ½ä¸æœƒæ”¹è®Šï¼ŒMemoChild å°±èƒ½æˆåŠŸåœ°è¢«è¨˜æ†¶èµ·ä¾†ã€‚
-->

---

# æ³¨æ„äº‹é … - `React.memo` èˆ‡å­ç¯€é»

`children` çœ‹èµ·ä¾†ä¸€æ¨£ `!=` åƒè€ƒå€¼ä¸€æ¨£

````md magic-move
```jsx {*|2,7-9|14-19}
export default function Page() {
  const [count, setCount] = useState(0);

  return (
    <div>
      <button onClick={() => setCount(count + 1)}>Click me</button>
      <MemoChild>
        <p>Child</p>
      </MemoChild>
    </div>
  );
}

function Child({ children }) {
  // ğŸ‘‡ é€™å€‹ console.log æœƒä¸æœƒåŸ·è¡Œ
  console.log('child render', children);
  return <div>{children}</div>;
}
const MemoChild = memo(Child);
```
````

<!--
é‚„æœ‰ä¸€å€‹éå¸¸å®¹æ˜“èª¤ç”¨çš„åœ°æ–¹ï¼Œå¾ˆå¤šäººä»¥ç‚ºåªè¦å­çµ„ä»¶æ²’æœ‰ Propsï¼Œæˆ–æ˜¯å‚³å…¥çš„ children çœ‹èµ·ä¾†æ²’æœ‰æ”¹è®Šï¼Œmemo å°±èƒ½é¿å…é‡æ¸²æŸ“ï¼Œä½†å¯¦éš›ä¸Šå®Œå…¨ä¸æ˜¯é€™æ¨£ã€‚

æˆ‘å€‘å†ä¾†çœ‹ä¸€å€‹å¸¸è¦‹çš„éŒ¯èª¤å¯«æ³•ï¼š

[click]
é€™é‚Šï¼Œæˆ‘å€‘å°‡ä¸€å€‹éœæ…‹çš„ `<p>Child</p>` åŒ…è£åœ¨ MemoChild ä¸­ã€‚

çµ¦ä½ æ€è€ƒ 5 ç§’ï¼Œä½ è¦ºå¾—åœ¨ count æ”¹è®Šæ™‚ï¼Œé€™å€‹ MemoChild æœƒè¢«é‡æ–°æ¸²æŸ“å—ï¼Ÿ

[click]
ä¹Ÿå°±æ˜¯é€™å€‹ console.log æœƒè¢«åŸ·è¡Œå—ï¼Ÿ
-->

---

<Video>
  <source src="/ch-5/5-4/2.mp4" type="video/mp4" />
</Video>

<!--
ç­”æ¡ˆæ˜¯æœƒ
-->

---
layout: center
---

# ç‚ºä»€éº¼ï¼Ÿ

---

# å› ç‚º children æœ¬è³ªä¸Šé‚„æ˜¯ç‰©ä»¶

<v-clicks>

æˆ‘å€‘å¹³å¸¸å¯«çš„ **`children` åªæ˜¯ä¸€å€‹èªæ³•ç³–**ï¼Œä¸‹é¢å…©ç¨®å¯«æ³•æ˜¯å®Œå…¨ç›¸åŒçš„ï¼š

```jsx
<MemoChild>
  <p>Child</p>
</MemoChild>

// ç­‰åŒæ–¼

<MemoChild children={<p>Child</p>} />
```

`<p>child</p>` æ˜¯ `React.createElement` çš„èªæ³•ç³–ï¼Œå®ƒæœƒå›å‚³ä¸€å€‹ç‰©ä»¶

```jsx
{
  type: "p",
  ... // å…¶ä»–å±¬æ€§
}
```

</v-clicks>

<!--
å› ç‚º children æœ¬è³ªä¸Šé‚„æ˜¯ç‰©ä»¶åƒè€ƒå€¼

[click]
æˆ‘å€‘å¹³å¸¸å¯«çš„ children åªæ˜¯ä¸€å€‹èªæ³•ç³–

[click]
ä¸‹é¢å…©ç¨®å¯«æ³•æ˜¯å®Œå…¨ç›¸åŒçš„ï¼š

[click]
è€Œ<p>child</p> ä¹Ÿæ˜¯ React.createElement çš„èªæ³•ç³–ï¼Œ


TODD: createElement æ˜¯ legacy çš„ APIï¼Œç¾åœ¨å·²ç¶“è¢«æ£„ç”¨ï¼Œ

ç¾åœ¨ç”¨

import { jsx as _jsx } from "react/jsx-runtime";
/*#__PURE__*/_jsx("div", {
  children: "1"
});

[click]

å®ƒæœƒå›å‚³ä¸€å€‹é€™æ¨£çš„ç‰©ä»¶ï¼Œæ‰€ä»¥æ¯æ¬¡ Re-renderï¼Œä»–éƒ½æ˜¯ä¸€å€‹æ–°çš„ç‰©ä»¶ã€æ–°çš„åƒè€ƒå€¼ã€‚

æ²’éŒ¯ï¼Œåˆæ˜¯åƒè€ƒå€¼çš„å•é¡Œï¼Œå› æ­¤å³ä½¿å…§å®¹ç›¸åŒï¼Œåªè¦æ˜¯æ–°çš„ React Elementï¼ŒMemoChild çš„ props.children å°±è¢«è¦–ç‚ºå·²ç¶“æ”¹è®Šï¼Œå°è‡´é‡æ–°æ¸²æŸ“ã€‚
-->

---

# è§£æ³•ï¼šè¨˜æ†¶ JSX

ä½¿ç”¨ `useMemo` æˆ– `useCallback` è¨˜æ†¶åŒ– JSX

````md magic-move
```jsx
export default function Page() {
  const [count, setCount] = useState(0);

  return (
    <div>
      <button onClick={() => setCount(count + 1)}>Click me</button>
      <MemoChild>
        <p>Child</p>
      </MemoChild>
    </div>
  );
}
```

```jsx
export default function Page() {
  const [count, setCount] = useState(0);

  const childContent = useMemo(() => <p>Child</p>, []);

  return (
    <div>
      <button onClick={() => setCount(count + 1)}>Click me</button>
      <MemoChild>{childContent}</MemoChild>
    </div>
  );
}
```
````

<!--
æœ‰ 2 å€‹æ–¹æ³•å¯ä»¥è§£æ±ºé€™å€‹å•é¡Œï¼Œ

ç¬¬ä¸€å€‹æ˜¯ä½¿ç”¨ useMemo å°‡ children å…ƒç´ è¨˜æ†¶ä¸‹ä¾†ï¼š
é€™æ¨£å°±èƒ½ç¢ºä¿ children çš„åƒè€ƒå€¼ä¸æœƒåœ¨æ¯æ¬¡æ¸²æŸ“æ™‚è®Šå‹•ï¼Œmemo æ‰èƒ½çœŸæ­£ç™¼æ®æ•ˆæœã€‚


[click]

å°±åƒé€™æ¨£

é‚£ç¬¬äºŒå€‹æ–¹æ³•ï¼Œæ˜¯å‚³å…¥ memo çš„æ¯”è¼ƒå‡½æ•¸ä¾†è§£é€™å€‹å•é¡Œ
ä¸éå› ç‚ºæ™‚é–“çš„é—œä¿‚ï¼Œæˆ‘å€‘å°±å…ˆè·³éé€™å€‹éƒ¨åˆ†

// TODO: åŠ å…¥ custom comparison function è¬›è§£
-->

---

# åˆä¸€å€‹é™·é˜±ï¼šåµŒå¥—è¨˜æ†¶åŒ–çµ„ä»¶

````md magic-move
```jsx
function Parent({ children }) {
  console.log('Parent render');
  return <div>{children}</div>;
}
const MemoParent = memo(Parent);

function Child() {
  console.log('Child render');
  return <div>Child</div>;
}
const MemoChild = memo(Child);
```

```jsx {7-9}
export default function Page() {
  const [count, setCount] = useState(0);

  return (
    <>
      <button onClick={() => setCount(count + 1)}>Click me</button>
      <MemoParent>
        <MemoChild />
      </MemoParent>
    </>
  );
}
```
````

<!--
æˆ‘å€‘å†ä¾†çœ‹çœ‹å¦ä¸€å€‹å®¹æ˜“è¸©é›·çš„ç¯„ä¾‹ï¼Œ

ç¾åœ¨æœ‰å…©å€‹è¢«è¨˜æ†¶åŒ–çš„çµ„ä»¶ï¼Œåˆ†åˆ¥æ˜¯ MemoParent å’Œ MemoChildã€‚

[click]
ç¾åœ¨æˆ‘å€‘å°‡ MemoChild åŒ…è£åœ¨ MemoParent ä¸­ï¼š

ä½ è¦ºå¾—ç•¶ count æ”¹è®Šæ™‚ï¼Œæ˜¯ MemoParent é‚„æ˜¯ MemoChild æœƒ Re-render å‘¢ï¼Ÿ
-->

---

# åªæœ‰ MemoParent æœƒ re-render

<Video>
  <source src="/ch-5/5-4/3.mp4" type="video/mp4" />
</Video>

<!--
ç­”æ¡ˆåªæœ‰ MemoParent æœƒ re-render
-->

---

# ç‚ºä»€éº¼ï¼Ÿ

<div mt-12>

å› ç‚º MemoChild å…¶å¯¦ä¹Ÿæ˜¯ä¸€å€‹ React Element ç‰©ä»¶ï¼Œ
<br/>
ä¹Ÿå°±æ˜¯ä¸€å€‹ JS ç‰©ä»¶ï¼Œåªæ˜¯å¤šäº†ä¸€å€‹å…§éƒ¨å±¬æ€§ `$$typeof`

```js
{
  "$$typeof": REACT_MEMO_TYPE, // React å…§éƒ¨æ¨™è¨˜ï¼Œä»£è¡¨ä»–è¢« memo åŒ…è£¹
  "type": Child,  // å‡½å¼çµ„ä»¶æœ¬é«”
  // å…¶ä»– props...
}
```

<v-click>

<span v-mark="{color: 'var(--secondary)', at: 1}">`MemoChild` æ¯æ¬¡éƒ½æ˜¯ä¸€å€‹æ–°çš„åƒè€ƒå€¼</span>ï¼Œæ‰€ä»¥ `MemoParent` æœƒé‡æ–°æ¸²æŸ“

</v-click>

</div>

<!--
ç‚ºä»€éº¼å‘¢ï¼Ÿ

åŸå› æ˜¯å› ç‚ºï¼Œé›–ç„¶ MemoChild æœ¬èº«æ˜¯è¢« memo åŒ…è£¹çš„ï¼Œä½†ï¼š

MemoChild æœ¬èº«é‚„æ˜¯ä¸€å€‹ React Element ç‰©ä»¶ï¼Œåªæ˜¯å¤šäº†ä¸€å€‹å…§éƒ¨å±¬æ€§ $$typeofï¼š

ï¼ˆå°±åƒé€™å€‹ç¨‹å¼ç¢¼ï¼‰



[click]

æ›å¥è©±èªªï¼ŒMemoChild æœ¬èº«é‚„æ˜¯ä¸€å€‹æ™®é€šçš„ JS ç‰©ä»¶

æ‰€ä»¥ MemoChild æ¯æ¬¡éƒ½æ˜¯ä¸€å€‹æ–°çš„åƒè€ƒå€¼ï¼Œå°è‡´ MemoParent æœƒé‡æ–°æ¸²æŸ“
-->

---

# è§£æ³•ï¼šä¸€æ¨£ä½¿ç”¨ `useMemo` æˆ– `useCallback` è¨˜æ†¶åŒ– JSX

<div>

````md magic-move
```jsx
const Component = () => {
  const child = useMemo(() => <ChildMemo />, []);
  return <ParentMemo>{child}</ParentMemo>;
};
```

```jsx
const Component = () => {
  const child = useMemo(() => <Child />, []);
  return <ParentMemo>{child}</ParentMemo>;
};
```
````

</div>

<!--
è¦è§£æ±ºé€™å€‹å•é¡Œï¼Œæˆ‘å€‘é‚„æ˜¯éœ€è¦å»è¨˜æ†¶åŒ–é€™å€‹ç‰©ä»¶æœ¬èº«ï¼š

ä¸éé€™å€‹ä¾‹å­ä¸­ï¼Œå¦‚æœç‚ºäº†é˜²æ­¢ ParentMemo é‡æ–°æ¸²æŸ“ï¼Œé‚£ ChildMemo æ˜¯å¤šé¤˜çš„

[click]
æˆ‘å€‘ç›´æ¥åƒä¸Šå€‹ç¯„ä¾‹ä¸€æ¨£å–®ç´”è¨˜æ†¶åŒ– JSX å°±å¥½ã€‚
-->

---

# ç¸½çµ

<v-clicks>

## `React.memo` vs `useMemo` vs `useCallback`

- `useMemo`ï¼šè¨˜æ†¶ã€Œ**å€¼**ã€ï¼ˆç‰©ä»¶ã€é™£åˆ—ã€JSXï¼‰
- `useCallback`ï¼šè¨˜æ†¶ã€Œ**å‡½å¼**ã€
- `React.memo`ï¼šè¨˜æ†¶ã€Œ**æ•´å€‹çµ„ä»¶**ã€

</v-clicks>

<v-click>

## `React.memo` å¸¸è¦‹é™·é˜±

</v-click>

<v-clicks>

- ä¸è¦ç›´æ¥æŠŠç‰©ä»¶ã€é™£åˆ—ã€å‡½å¼ã€JSX å¯«æˆ Inline Props
- **`children` æœ¬è³ªä¸Šæ˜¯ React elementï¼ˆç‰©ä»¶ï¼‰**ï¼Œæ¯æ¬¡ Render éƒ½æ˜¯æ–°ç‰©ä»¶ï¼ˆæ–°çš„åƒè€ƒå€¼ï¼‰
- å³ä½¿å­å…ƒçµ„ä»¶æ˜¯ `memo` éçš„ï¼Œ**ä¹Ÿä¸èƒ½ç›´æ¥å¯«æˆ Childrenï¼Œè¦å…ˆä½¿ç”¨ useMemo è¨˜æ†¶åŒ–**

</v-clicks>

<!--
æœ€å¾Œç¸½çµä¸€ä¸‹

[click]

React.memo vs useMemo vs useCallback

[click]
- useMemoï¼šè¨˜æ†¶ã€Œå€¼ã€ï¼ˆç‰©ä»¶ã€é™£åˆ—ã€JSXï¼‰
- useCallbackï¼šè¨˜æ†¶ã€Œå‡½å¼ã€
- React.memoï¼šè¨˜æ†¶ã€Œæ•´å€‹çµ„ä»¶ã€

[click]
React.memo å¸¸è¦‹é™·é˜±

[click]
ä¸è¦ç›´æ¥æŠŠç‰©ä»¶ã€é™£åˆ—ã€å‡½å¼ã€JSX å¯«æˆ Inline Props

[click]
children æœ¬è³ªä¸Šæ˜¯ React elementï¼ˆç‰©ä»¶ï¼‰ï¼Œæ¯æ¬¡ Render éƒ½æ˜¯æ–°ç‰©ä»¶ï¼ˆæ–°çš„åƒè€ƒå€¼ï¼‰

[click]
å³ä½¿å­å…ƒçµ„ä»¶æ˜¯ memo éçš„ï¼Œä¹Ÿä¸èƒ½ç›´æ¥å¯«æˆ Childrenï¼Œè¦å…ˆä½¿ç”¨ useMemo è¨˜æ†¶åŒ–
-->

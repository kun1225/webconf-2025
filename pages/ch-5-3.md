---
layout: center
transition: blur-in
---

<ThemeTitle number="3">
ç‹€æ…‹ä¿ç•™
</ThemeTitle>

<!--
å‰ 2 å€‹ç« ç¯€ï¼Œæˆ‘å€‘ä»‹ç´¹äº†ç‹€æ…‹ä¸‹ç§»ä»¥å…§å®¹ä¸Šç§» 2 ç¨®å„ªåŒ–æ–¹å¼ã€‚

é€™å€‹ç« ç¯€ï¼Œè¦ä¾†ä»‹ç´¹ **React 19 æœ€æ–°æ¨å‡ºçš„ Component â€” `<Activity />`**

è€æ¨£å­ï¼Œæˆ‘å€‘å¾ä¸€å€‹éœ€æ±‚é–‹å§‹ã€‚
-->

---

# ç¬¬ 3 å€‹éœ€æ±‚ï¼šå¸Œæœ› Tab ä¿ç•™ç‹€æ…‹

PM å¸Œæœ›ä½¿ç”¨è€…å¯ä»¥è‡ªå·±æ–°å¢è³‡æ–™ï¼Œä¹Ÿèƒ½åšä¸€äº›è¨­å®šï¼Œä¾‹å¦‚èªè¨€ã€ä¸»é¡Œç­‰ç­‰ã€‚

<Video class="max-h-[400px]">
<source src="/ch-5/5-2-5/1.mp4" type="video/mp4" />
</Video>

<!--
ç¾åœ¨ä¸€æ¨£æ˜¯ä¸€å€‹é¡ä¼¼çš„åœ–è¡¨é é¢ï¼ŒPM å¸Œæœ›ä½¿ç”¨è€…å¯ä»¥è‡ªå·±æ–°å¢è³‡æ–™ï¼Œä¸¦åœ¨æ—é‚Šåšä¸€äº›è¨­å®šï¼Œä¾‹å¦‚èªè¨€ã€ä¸»é¡Œç­‰ç­‰ã€‚

æ–¼æ˜¯æˆ‘å€‘å¾ˆå¿«é€Ÿåœ°æ–°å¢äº†ä¸€å€‹ Tab çµ„ä»¶ï¼Œè£¡é¢æœ‰ `FilterForm`ã€`DataInputTab` å’Œ `SettingsTab`ï¼š
-->

---
layout: section
---

## æ–°å¢ Tab

````md magic-move
```jsx {all|6|8-21|23}
export default function Page() {
  const [data, setData] = useState(initialData);

  return (
    <>
      <FilterForm />

      <Tabs defaultValue="add" className="mt-4 w-full">
        <TabsList className="grid w-full grid-cols-2">
          <TabsTrigger value="add">æ–°å¢è³‡æ–™</TabsTrigger>
          <TabsTrigger value="other">ç”¨æˆ¶è¨­ç½®</TabsTrigger>
        </TabsList>

        <TabsContent value="add">
          <DataInputTab setData={setData} />
        </TabsContent>

        <TabsContent value="other">
          <SettingsTab />
        </TabsContent>
      </Tabs>

      <HeavyCharts data={data} />
    </>
  );
}
```
````

<!--
æ–¼æ˜¯æˆ‘å€‘å¾ˆå¿«é€Ÿåœ°æ–°å¢äº†ä¸€å€‹ Tab çµ„ä»¶ï¼Œè£¡é¢æœ‰ 

[click]
FilterFormã€

[click]
Tabs åŒ…å«
DataInputTab
SettingsTab

[click]
ä»¥åŠåœ–è¡¨ HeavyCharts
-->

---

# å•é¡Œåœ¨å“ªï¼Ÿ

åˆ‡æ› Tab ç‹€æ…‹ä¸Ÿå¤±ã€‚

<Video class="max-h-[400px]">
<source src="/ch-5/5-2-5/2.mp4" type="video/mp4" />
</Video>

<!--
å¾ˆå–®ç´”çš„éœ€æ±‚ï¼Œä½¿ç”¨èµ·ä¾†ä¹Ÿæ²’ä»€éº¼å•é¡Œã€‚

çµæœä¸Šç·šå¾Œï¼Œä½¿ç”¨è€…å¸Œæœ›åœ¨**åˆ‡æ› Tab æ™‚å¯ä»¥ä¿ç•™å¡«å¯«ä¸­çš„è³‡æ–™**ï¼Œä½†ç¾åœ¨åˆ‡æ› Tab æœƒå°è‡´ç‹€æ…‹ä¸Ÿå¤±ï¼š
-->

---

# ä¿®æ­£å•é¡Œ

````md magic-move
```jsx {all|4-9|21-28}
export default function Page() {
  const [data, setData] = useState(initialData);

  /* ğŸ‘‡ åŸæœ¬åœ¨ DataInputTab è£¡é¢çš„ç‹€æ…‹ */
  const [newData, setNewData] = useState({
    date: new Date().toISOString().split('T')[0],
    visitors: 0,
    active: 0,
  });

  return (
    <>
      <FilterForm />

      <Tabs defaultValue="add" className="mt-4 w-full">
        <TabsList className="grid w-full grid-cols-2">
          <TabsTrigger value="add">æ–°å¢è³‡æ–™</TabsTrigger>
          <TabsTrigger value="other">ç”¨æˆ¶è¨­ç½®</TabsTrigger>
        </TabsList>

        {/* ğŸ‘‡ å°‡ newData å’Œ setNewData å¾€ä¸‹å‚³ */}
        <TabsContent value="add">
          <DataInputTab
            setData={setData}
            newData={newData}
            setNewData={setNewData}
          />
        </TabsContent>

        <TabsContent value="other">
          <SettingsTab />
        </TabsContent>
      </Tabs>

      <HeavyCharts data={data} />
    </>
  );
}
```
````

<!--
é€™ä¹Ÿæ˜¯å¾ˆæ­£å¸¸çš„éœ€æ±‚ï¼Œå¦‚æœè¡¨å–®å¾ˆè¤‡é›œï¼Œä½¿ç”¨è€…ä¸æœƒå¸Œæœ›ä¸€åˆ‡æ› Tab å°±å°è‡´è³‡æ–™å…¨éƒ¨æ¸…ç©ºã€‚

è¦å®Œæˆé€™å€‹éœ€æ±‚ä¹Ÿä¸å›°é›£ï¼Œ

[click]
æˆ‘å€‘æŠŠ `<DataInputTab>` è£¡é¢çš„ç‹€æ…‹ï¼Œä¹Ÿå°±æ˜¯ `newData` ç§»åˆ°çˆ¶çµ„ä»¶

[click]
ä¸¦å°‡ç‹€æ…‹å‚³çµ¦ `<DataInputTab>` å°±å¥½äº†ï¼Œå°±åƒä¸‹é¢çš„ç¨‹å¼ç¢¼ï¼š
-->

---

# å•é¡Œåˆåœ¨å“ªï¼Ÿ

å› ç‚º `HeavyCharts` çš„é—œä¿‚ï¼Œå°è‡´æ¯æ¬¡è¼¸å…¥è³‡æ–™æ™‚ï¼Œéƒ½æœƒå› ç‚º Re-render å»¶é²ã€‚

````md magic-move
```jsx {all|7}
export default function Page() {
  const [data, setData] = useState(initialData);

  return (
    <>
      <FilterForm />
      <PageTabs setData={setData} />
      <HeavyCharts data={data} />
    </>
  );
}
```

```jsx
function PageTabs({ setData }) {
  const [newData, setNewData] = useState({
    date: new Date().toISOString().split('T')[0],
    visitors: 0,
    active: 0,
  });

  return (
    <Tabs defaultValue="add" className="mt-4 w-full">
      <TabsList className="grid w-full grid-cols-2">
        <TabsTrigger value="add">æ–°å¢è³‡æ–™</TabsTrigger>
        <TabsTrigger value="other">ç”¨æˆ¶è¨­ç½®</TabsTrigger>
      </TabsList>

      <TabsContent value="add">
        <DataInputTab
          setData={setData}
          newData={newData}
          setNewData={setNewData}
        />
      </TabsContent>

      <TabsContent value="other">
        <SettingsTab />
      </TabsContent>
    </Tabs>
  );
}
```
````

<!--
çµæœä½ ä¸€æ¸¬ï¼Œç™¼ç¾å®Œè›‹ï¼Œå› ç‚º `HeavyCharts` çš„é—œä¿‚ï¼Œå°è‡´æ¯æ¬¡è¼¸å…¥è³‡æ–™æ™‚ï¼Œéƒ½æœƒå› ç‚º Re-render å»¶é²ã€‚

[click]
æ–¼æ˜¯ä½ æƒ³åˆ°äº†å‰ 2 å€‹ç« ç¯€çš„ç‹€æ…‹ä¸‹ç§»æŠ€å·§ï¼Œæˆ‘å°‡ `newData` å’Œ `Tabs`  å°è£æˆä¸€å€‹ `PageTabs` ä¸å°±å¥½äº†å—ï¼Ÿ


ç•¶ç„¶é€™é‚Šä¹Ÿå¯ä»¥å°‡ **`HeavyCharts`** ç”¨ `React.memo` åŒ…èµ·ä¾†ã€‚
ä¸éå¤§å¤šæ•¸æ™‚å€™ï¼Œåˆ©ç”¨ç‹€æ…‹ä¸‹ç§»æœƒæ˜¯æ›´ä¹¾æ·¨çš„é¸æ“‡ã€‚

[click]
PageTabs è£¡é¢å°±æ˜¯åŸæœ¬ Tabs çš„å…§å®¹ï¼Œå’Œä¸€å€‹ newData çš„ç‹€æ…‹

å®Œç¾è§£æ±ºå•é¡Œäº†ï¼
-->

---

# åˆæœ‰æ–°éœ€æ±‚

PM èªªè¦å¤šæ–°å¢å…¶ä»–çš„ `TabsContent`ï¼ŒåŒæ™‚æ¯å€‹ Tab çš„ç‹€æ…‹éƒ½è¦ä¿ç•™

<v-click>

```jsx
export function PageTabs({ setData }) {
  const [newData, setNewData] = useState({
    date: new Date().toISOString().split('T')[0],
    visitors: 0,
    active: 0,
  });

  const [theme, setTheme] = useState('light');
  const [language, setLanguage] = useState('zh-TW');
  const [emailNotifications, setEmailNotifications] = useState(false);
  const [pushNotifications, setPushNotifications] = useState(true);

  const [range, setRange] = useState('7d');
  const [country, setCountry] = useState('all');
  const [device, setDevice] = useState('all');

  const [showChart, setShowChart] = useState(true);
  const [showTable, setShowTable] = useState(true);
  const [chartType, setChartType] = useState('line');

  return (
    <Tabs defaultValue="add" className="mt-4 w-full">
      <TabsList className="grid w-full grid-cols-4">
        <TabsTrigger value="add">æ–°å¢è³‡æ–™</TabsTrigger>
        <TabsTrigger value="settings">ç”¨æˆ¶è¨­ç½®</TabsTrigger>
        <TabsTrigger value="filter">å ±è¡¨ç¯©é¸</TabsTrigger>
        <TabsTrigger value="view">è¦–åœ–è¨­å®š</TabsTrigger>
      </TabsList>

      <TabsContent value="add">
        <DataInputTab
          setData={setData}
          newData={newData}
          setNewData={setNewData}
        />
      </TabsContent>

      <TabsContent value="settings">
        <SettingsTab
          theme={theme}
          setTheme={setTheme}
          language={language}
          setLanguage={setLanguage}
          emailNotifications={emailNotifications}
          setEmailNotifications={setEmailNotifications}
          pushNotifications={pushNotifications}
          setPushNotifications={setPushNotifications}
        />
      </TabsContent>

      <TabsContent value="filter">
        <ReportFilterTab
          range={range}
          setRange={setRange}
          country={country}
          setCountry={setCountry}
          device={device}
          setDevice={setDevice}
        />
      </TabsContent>

      <TabsContent value="view">
        <ViewOptionsTab
          showChart={showChart}
          setShowChart={setShowChart}
          showTable={showTable}
          setShowTable={setShowTable}
          chartType={chartType}
          setChartType={setChartType}
        />
      </TabsContent>
    </Tabs>
  );
}
```

</v-click>

<!--
ä¸éé€™æ™‚å€™ PM èªªè¦å¤šæ–°å¢å…¶ä»–çš„ `TabsContent`ï¼ŒåŒæ™‚æ¯å€‹ Tab çš„ç‹€æ…‹éƒ½è¦ä¿ç•™ï¼Œä¸èƒ½å› ç‚ºåˆ‡æ› Tab å°è‡´ç‹€æ…‹ä¸Ÿå¤±

[click]
æ–¼æ˜¯ä½ é–‹å§‹æŠŠæ‰€æœ‰ Tab çš„ç‹€æ…‹éƒ½ç§»åˆ° `PageTabs` ä¸­ï¼š

å¯ä»¥çœ‹åˆ°ä¸Šé¢çš„ç¨‹å¼ç¢¼å°±æ˜¯ä¸€å † stateï¼Œç„¶å¾Œå‚³åˆ°æ¯å€‹å­çµ„ä»¶ã€‚

ç›¸ä¿¡ä½ å€‘ä¸€å®šçœ‹éé€™æ¨£çš„å¯«æ³•â€¦ï¼Œè®“æˆ‘å›æƒ³èµ·ä»¥å‰ææ€–çš„èˆŠå°ˆæ¡ˆã€‚

æ‰€ä»¥ç•¶æ–°å¢çš„ **`TabsContent`** è¶Šä¾†è¶Šå¤šï¼Œæ•´å€‹çµ„ä»¶ä¹Ÿè¶Šä¾†è¶Šé›£ç¶­è­·ï¼Œè©²æ€éº¼è¾¦å‘¢ï¼Ÿ

é€™ç¨®æ™‚å€™ï¼Œå°±å¯ä»¥æƒ³åˆ° React 19 æ–°æ¨å‡ºçš„ `<Activity />` å•¦ï¼
-->

---

# ä»€éº¼æ˜¯ `<Activity />`

`<Activity />` å¯ä»¥è®“æˆ‘å€‘å°‡ç‹€æ…‹ä¿ç•™åœ¨å„è‡ªçš„çµ„ä»¶ä¸­ï¼Œä¸¦ä¸æœƒå› ç‚ºçµ„ä»¶è¢« unmount è€Œå°è‡´ç‹€æ…‹ä¸Ÿå¤±ã€‚

```jsx
import { Activity } from 'react';

<Activity mode="visible | hidden">
  <SomeComponent />
</Activity>

<Activity mode={isActive ? 'visible' : 'hidden'}>
  <SomeComponent />
</Activity>
```

**ç•¶ `mode="hidden"` æ™‚ï¼Œçµ„ä»¶ä¸æœƒé¡¯ç¤ºä½† state èˆ‡ DOM æœƒè¢«ä¿ç•™ä¸‹ä¾†ã€‚**

<!--
`<Activity />` å¯ä»¥è®“æˆ‘å€‘å°‡ç‹€æ…‹ä¿ç•™åœ¨å„è‡ªçš„çµ„ä»¶ä¸­ï¼Œä¸¦ä¸æœƒå› ç‚ºçµ„ä»¶è¢« unmount è€Œå°è‡´ç‹€æ…‹ä¸Ÿå¤±ã€‚

ä½¿ç”¨æ–¹æ³•å¾ˆç°¡å–®ï¼Œæˆ‘å€‘å¯ä»¥å‚³å…¥ mode ä¾†æ§åˆ¶çµ„ä»¶æ˜¯å¦é¡¯ç¤ºï¼š

ç•¶ mode="hidden" æ™‚ï¼Œçµ„ä»¶ä¸æœƒé¡¯ç¤ºä½† state èˆ‡ DOM æœƒè¢«ä¿ç•™ä¸‹ä¾†ã€‚
-->

---

# ç”¨ `<Activity />` é‡å¯« Tabs

```jsx{all|8-31}
export function PageTabs({ setData }) {
  const [activeTab, setActiveTab] = useState('add');

  return (
    <Tabs>
      <TabsList className="grid w-full grid-cols-4">...</TabsList>

      <Activity mode={activeTab === 'add' ? 'visible' : 'hidden'}>
        <TabsContent value="add">
          <DataInputTab setData={setData} />
        </TabsContent>
      </Activity>

      <Activity mode={activeTab === 'settings' ? 'visible' : 'hidden'}>
        <TabsContent value="settings">
          <SettingsTab />
        </TabsContent>
      </Activity>

      <Activity mode={activeTab === 'filter' ? 'visible' : 'hidden'}>
        <TabsContent value="filter">
          <ReportFilterTab />
        </TabsContent>
      </Activity>

      <Activity mode={activeTab === 'view' ? 'visible' : 'hidden'}>
        <TabsContent value="view">
          <ViewOptionsTab />
        </TabsContent>
      </Activity>
    </Tabs>
  );
}
```

<!--
äº†è§£ <Activity /> å¾Œï¼Œæˆ‘å€‘å¯ä»¥å¾ˆç°¡å–®çš„å»é‡å¯« Tabsï¼Œä¸¦å°‡ç‹€æ…‹ç•™åœ¨å„è‡ªçš„çµ„ä»¶ä¸­ï¼Œè®“æ•´é«”ç¶­è­·æ€§æ›´é«˜ã€‚

[click]
ä¿®æ”¹æ–¹å¼ä¹Ÿéå¸¸ç°¡å–®ï¼Œåªè¦åœ¨ TabsContent å¤–é¢ï¼Œä½¿ç”¨ Activity å³å¯ï¼Œä¸¦ä¸”æ ¹æ“šç›®å‰çš„ Tab ä¾†æ±ºå®š visible æˆ– hiddenï¼š
-->

---

<Video>
<source src="/ch-5/5-2-5/4.mp4" type="video/mp4" />
</Video>

<!--
å¯ä»¥çœ‹åˆ°æ‰€ä»¥ Tabs çš„ç‹€æ…‹è¢«ä¿ç•™äº†ï¼Œç¨‹å¼ç¢¼ä¹Ÿå¥½ç¶­è­·å¾ˆå¤šï¼
-->

---

# ç‚ºä»€éº¼ `<Activity />` å¯ä»¥ä¿ç•™ç‹€æ…‹ï¼Ÿ

å…¶å¯¦ `<Activity />` çš„åŸç†ä¸å›°é›£ï¼Œä»–æ˜¯åˆ©ç”¨ `display: none` ä¾†æ§åˆ¶æ˜¯å¦é¡¯ç¤ºçµ„ä»¶ã€‚

<br>

<v-click>

é›–ç„¶çµ„ä»¶æœ¬èº«æ²’æœ‰è¢« unMount ä½† Effect ä»ç„¶æœƒè¢«æ¸…ç©ºï¼Œæ‰€ä»¥ç•¶ `<Activity mode=â€visibleâ€ />` æ™‚

**ä»ç„¶æœƒåŸ·è¡Œ Effect è£¡é¢çš„é‚è¼¯ã€‚**

</v-click>

<br>

<v-click>

ä¸éä¹Ÿæ˜¯å› ç‚ºçµ„ä»¶æœ¬èº«æ²’æœ‰è¢« unmountï¼Œæ‰€ä»¥ç•¶çˆ¶çµ„ä»¶ Re-render æ™‚

`<Activity />` å…§éƒ¨çš„çµ„ä»¶ä¹Ÿæœƒè¢«å½±éŸ¿ï¼Œä¸ç®¡ä»–ç¾åœ¨æ˜¯ä¸æ˜¯é¡¯ç¤ºçš„ç‹€æ…‹ã€‚

</v-click>

<!--
å…¶å¯¦ `<Activity />` çš„åŸç†ä¸å›°é›£ï¼Œä»–æ˜¯åˆ©ç”¨ `display: none` ä¾†æ§åˆ¶æ˜¯å¦é¡¯ç¤ºçµ„ä»¶ã€‚

[click]
ç‰¹åˆ¥çš„æ˜¯ï¼Œé›–ç„¶çµ„ä»¶æœ¬èº«æ²’æœ‰è¢« unMountï¼Œ**ä½† Effect ä»ç„¶æœƒè¢«æ¸…ç©ºï¼Œæ‰€ä»¥ç•¶ `<Activity mode=â€visibleâ€ />` æ™‚ï¼Œä»ç„¶æœƒåŸ·è¡Œ Effect è£¡é¢çš„é‚è¼¯ã€‚**

[click]
ä¸éä¹Ÿæ˜¯å› ç‚ºçµ„ä»¶æœ¬èº«æ²’æœ‰è¢« unmountï¼Œæ‰€ä»¥**ç•¶çˆ¶çµ„ä»¶ Re-render æ™‚ï¼Œ`<Activity />` å…§éƒ¨çš„çµ„ä»¶ä¹Ÿæœƒè¢«å½±éŸ¿ï¼Œä¸ç®¡ä»–ç¾åœ¨æ˜¯ä¸æ˜¯é¡¯ç¤ºçš„ç‹€æ…‹ã€‚**

ä»€éº¼æ„æ€å‘¢ï¼Ÿ
-->

---

```jsx {all|2,4-6}
function DataInputTab({ setData }) {
  console.log('DataInputTab');

  useEffect(() => {
    console.log('Effect DataInputTab');
  }, []);

  // å…¶ä»–ç¨‹å¼ç¢¼ ...

  return ( ... );
}
```

<!--
ä»€éº¼æ„æ€å‘¢ï¼Ÿæˆ‘å€‘åœ¨ç¬¬ä¸€å€‹ Tabs ä¸Šé¢

[click]
åŠ ä¸Šä¸€å€‹ console.log å’Œ useEffect è©¦è©¦çœ‹ï¼š
-->

---

<Video>
<source src="/ch-5/5-2-5/5.mp4" type="video/mp4" />
</Video>

<!--
ç•¶åˆ‡æ› Tabs æ™‚ï¼Œå¯ä»¥ç™¼ç¾æœƒä¸€ç›´æ‰“å° DataInputTabï¼Œè€Œç•¶åˆ‡æ›åˆ° DataInputTab çµ„ä»¶æ™‚ï¼Œæœƒæ‰“å° Effect DataInputTabã€‚

é€™æ˜¯å› ç‚ºè¢« <Activity /> åŒ…ä½çš„çµ„ä»¶ä¸¦æ²’æœ‰çœŸæ­£çš„å¸è¼‰ï¼Œæ‰€ä»¥è¦æ³¨æ„ã€‚
-->

---
layout: center
---

# å°ç¸½çµ

`<Activity />` è®“æˆ‘å€‘å¯ä»¥å°‡ç‹€æ…‹ä¿ç•™åœ¨çµ„ä»¶å…§éƒ¨ã€‚

<!--
å¥½ï¼Œæœ€å¾Œåšå€‹å°ç¸½çµï¼Œ`<Activity />` è®“æˆ‘å€‘å¯ä»¥å°‡ç‹€æ…‹ä¿ç•™åœ¨çµ„ä»¶å…§éƒ¨ã€‚

é€™åœ¨ Tabs éœ€æ±‚ä¸Šé¢ç‰¹åˆ¥å¯¦ç”¨ï¼Œä¹Ÿå¯ä»¥è®“ Component çµæ§‹è®Šå¾—æ›´ä¹¾æ·¨ã€‚
-->

---
layout: center
transition: blur-in
---

<ThemeTitle number="2">
<span class="text-6xl">
State èˆ‡ Effect çš„æ„ç¾©èˆ‡æ©Ÿåˆ¶
</span>
</ThemeTitle>

<!--
æœ‰äº†å¤§è‡´çš„ React é‹ä½œæµç¨‹å¾Œï¼Œæˆ‘å€‘å°±å¯ä»¥æ›´ä»”ç´°çš„èŠèŠ state å’Œ effect

useState å’Œ useEffect å¯ä»¥èªªæ˜¯ React è£¡æœ€å¸¸ç”¨åˆ°çš„å…©å€‹ Hookï¼Œä½†è¦ç”¨å¥½ä¹Ÿæ˜¯ä¸å®¹æ˜“

ä½†å®ƒå€‘å¦‚æœç”¨éŒ¯äº†ï¼Œä¸åªæœƒå‡º bugï¼Œä¹Ÿæœƒç›´æ¥å½±éŸ¿æ•ˆèƒ½èˆ‡æ¸²æŸ“ç©©å®šæ€§ã€‚
-->

---
layout: center
---

<ChapterTitle number="1" subtitle="æ·±å…¥ç†è§£ç‹€æ…‹ç®¡ç†çš„é™·é˜±">
<span class="text-6xl">
<code>useState</code> å¸¸è¦‹éŒ¯èª¤è§£æ
</span>
</ChapterTitle>

<!--
é‚£æˆ‘å€‘å°±å…ˆå¾ useState é–‹å§‹ï¼Œè¨±å¤šå·¥ç¨‹å¸«å› ç‚ºå° useState è¡Œç‚ºç†è§£ä¸å¤ è€Œç”¢ç”ŸéŒ¯èª¤çš„ç”¨æ³•ï¼Œåš´é‡ä¸€é»é‚„å¯èƒ½ç”¢ç”Ÿæ•ˆèƒ½çš„å•é¡Œã€‚
-->

---

# ä¸€ã€Derived Stateï¼ˆæ´¾ç”Ÿç‹€æ…‹ã€è¡ç”Ÿç‹€æ…‹ï¼‰

æˆ‘å€‘å·²ç¶“çŸ¥é“ React Re-render çš„æœ¬è³ªå°±æ˜¯é‡æ–°åŸ·è¡Œæ•´å€‹ Functional Component

**åªè¦ state æ”¹è®Šå°±æœƒé‡æ–°åŸ·è¡Œï¼Œè¨ˆç®—æ–°çš„ UI**

````md magic-move
```jsx
export default function Form() {
  const [firstName, setFirstName] = useState('');
  const [lastName, setLastName] = useState('');
  const [fullName, setFullName] = useState('');

  useEffect(() => {
	  setFullName(firstName + lastName)
  }, [firstName, lastName])

  return ...
}
```

```jsx {2-4,6-8}
export default function Form() {
  const [firstName, setFirstName] = useState('');
  const [lastName, setLastName] = useState('');
  const [fullName, setFullName] = useState('');

  useEffect(() => {
	  setFullName(firstName + lastName)
  }, [firstName, lastName])

  return ...
}
```
````

<!--
æˆ‘å€‘ç¾åœ¨é€²å…¥ useState çš„ç¬¬ä¸€å€‹å¸¸è¦‹èª¤å€ï¼šDerived State ä¸­æ–‡å«æ´¾ç”Ÿç‹€æ…‹ã€è¡ç”Ÿç‹€æ…‹ã€‚

ä¹Ÿæ˜¯æˆ‘å€‘ä»Šå¤©è¦è¬›çš„ç¬¬ä¸€å€‹å„ªåŒ–æŠ€å·§ï¼Œæœ‰è »å¤šå·¥ç¨‹å¸«é›–ç„¶å·¥ä½œè »å¤šå¹´äº†ï¼Œä½†é‚„æ˜¯æœƒæ²’æ³¨æ„åˆ°é€™å€‹æŠ€å·§

Derived State è½èµ·ä¾†å¾ˆé›£ï¼Œä½†æ¦‚å¿µè·Ÿå¯¦ä½œæ–¹æ³•å…¶å¯¦éå¸¸ç°¡å–®ï¼Œé€™å€‹åè©ä¹Ÿä¸æ˜¯çœŸçš„å¾ˆé‡è¦ï¼Œé‡è¦çš„æ˜¯æ¦‚å¿µ

é€éå‰é¢çš„ç« ç¯€ï¼Œæˆ‘å€‘å·²ç¶“çŸ¥é“ React Re-render çš„æœ¬è³ªå°±æ˜¯é‡æ–°åŸ·è¡Œæ•´å€‹ function component

åªè¦ state æ”¹è®Šï¼Œcomponent function å°±æœƒé‡æ–°åŸ·è¡Œï¼Œè¨ˆç®—æ–°çš„ UIã€‚

çŸ¥é“é€™é»å¾Œï¼Œæˆ‘å€‘å†ä¾†çœ‹çœ‹é€™æ®µç¨‹å¼ç¢¼

[click]
é€™æ®µç¨‹å¼ç¢¼å¾ˆç°¡å–®ï¼Œä¸‰å€‹ stateï¼Œæ¯æ¬¡ firstName æˆ– lastName æ”¹è®Šæ™‚ï¼Œæˆ‘å€‘å°±ç”¨ useEffect å»æ›´æ–°ç¬¬ä¸‰å€‹ state - fullName
-->

---

# å•é¡Œåœ¨å“ªï¼Ÿ

æ¯æ¬¡éƒ½è¦ Re-render 2 æ¬¡

````md magic-move
```jsx {2-4,6-9}
export default function Form() {
  const [firstName, setFirstName] = useState('');
  const [lastName, setLastName] = useState('');
  const [fullName, setFullName] = useState('');

  useEffect(() => {
    // ç­‰ firstName æˆ– lastName æ›´æ–°å®Œå¾Œï¼Œå† re-render ä¸€æ¬¡ä¾†æ›´æ–° fullName
	  setFullName(firstName + lastName)
  }, [firstName, lastName]) //

  return ...
}
```

```jsx
export default function Form() {
  const [firstName, setFirstName] = useState('');
  const [lastName, setLastName] = useState('');

  const fullName = firstName + lastName; // ğŸ‘ˆ æ¯æ¬¡ Re-render æ™‚åŠæ™‚è¨ˆç®—å³å¯

  return ...
}
```
````

<v-click>

ç”¨ state è¨˜ä½å®ƒå°±éœ€è¦è®“ React å¹«ä½ ç¶­è­·ä¸€ä»½å¤šé¤˜çš„è³‡æ–™ï¼Œé‚„è¦ç”¨ useEffect ç›£è½ä¾è³´æ›´æ–°å®ƒã€‚

</v-click>

<!--
é€™æ¨£å¯¦ä½œåŠŸèƒ½ä¸Šæ˜¯ä¸æœƒæœ‰å•é¡Œçš„ï¼Œä½†æ˜¯æ¯æ¬¡ firstName æˆ– lastName æ›´æ–°ï¼Œæœƒå…ˆ Re-render ä¸€æ¬¡ï¼Œrender å®Œå¾ŒåŸ·è¡Œ useEffect æ›´æ”¹ fullNameï¼Œåˆæœƒå°è‡´ Re-render

ç­‰æ–¼æ¯æ¬¡éƒ½è¦ Re-render 2 æ¬¡ï¼Œå¦‚æœæ•´å€‹ app éƒ½å……æ–¥é€™ç¨®å¯«æ³•ï¼Œå°±å¯èƒ½å½±éŸ¿åˆ°æ•ˆèƒ½

[click]
é‚£æ€éº¼å„ªåŒ–å‘¢ï¼Ÿ
ç”±æ–¼æ¯æ¬¡ Re-render éƒ½æ˜¯é‡æ–°åŸ·è¡Œ functionï¼Œé€™ä»£è¡¨æˆ‘å€‘å¯ä»¥é€éåŸ·è¡Œ function çš„æ™‚å€™å³æ™‚ç®—å‡º fullNameï¼Œå°±åƒç¨‹å¼ç¢¼é€™æ¨£

å…¶å¯¦å¾ˆç°¡å–®

[click]
è€Œå¦‚æœæˆ‘å€‘åƒå‰›å‰›é‚£æ¨£ç”¨ state è¨˜ä½å®ƒï¼Œå°±éœ€è¦è®“ React å¹«ä½ ç¶­è­·ä¸€ä»½å¤šé¤˜çš„è³‡æ–™ï¼Œé‚„è¦ç”¨ useEffect ç›£è½ä¾è³´æ›´æ–°å®ƒã€‚
-->

---
layout: center
---

# Derived State çš„åŸå‰‡

<v-clicks>

èƒ½åœ¨ Re-render æœŸé–“è¨ˆç®—å‡ºä¾†ï¼Œå°±ä¸éœ€è¦ä½¿ç”¨ state

</v-clicks>

<!--
[click]
åªè¦èƒ½åœ¨ Re-render æœŸé–“è¨ˆç®—å‡ºä¾†çš„ï¼Œå°±ä¸éœ€è¦ä½¿ç”¨ stateï¼Œstate éœ€è¦æˆ‘å€‘é¡å¤–ç›£è½ä¾è³´ã€æ›´æ–°å®ƒ

ç›¡å¯èƒ½ç°¡åŒ–ä½ çš„ç‹€æ…‹é‚è¼¯

åˆ©ç”¨ re-render çš„ç‰¹æ€§ä¾†å¹«ä½ è¨ˆç®—è®Šæ•¸

é€™å…¶å¯¦æ˜¯ä¸€å€‹å°æŠ€å·§ï¼Œä½†èƒ½å¹«ä½ çœä¸‹å¾ˆå¤šéŒ¯èª¤èˆ‡æ•ˆèƒ½å•é¡Œã€‚

æœªä¾†ç•¶ä½ è¦ºå¾—æŸæ®µ useState + useEffect çš„é‚è¼¯æ€ªæ€ªçš„ï¼Œå›é ­æƒ³ï¼šã€Œé€™å€‹å€¼æ˜¯ç®—å‡ºä¾†çš„å—ï¼Ÿã€

å¦‚æœæ˜¯ï¼Œé‚£å°±ä¸è¦æ”¾é€² stateã€‚
-->

---

# äºŒã€åˆå§‹åŒ–å‡½æ•¸çš„ä½¿ç”¨æŠ€å·§èˆ‡èª¤å€

## ä¾†çœ‹ä¸€å€‹å ´æ™¯

````md magic-move
```jsx {*|2-7|9-15}
function Countdown({ targetTime }) {
  const [timeLeft, setTimeLeft] = useState({
    days: 0,
    hours: 0,
    minutes: 0,
    seconds: 0
  });

  useEffect(() => {
    const timer = setInterval(() => {
      setTimeLeft(calculateTimeLeft(targetTime));
    }, 1000);

    return () => clearInterval(timer);
  }, [targetTime]);

  return ...
 }
```
````

<!--
ç¬¬äºŒå€‹å¸¸è¢«å¿½ç•¥æˆ–ä½¿ç”¨éŒ¯èª¤çš„æ±è¥¿æ˜¯ï¼Œstate çš„åˆå§‹åŒ–å‡½æ•¸

æˆ‘å€‘å…ˆä¾†çœ‹ä¸€å€‹å ´æ™¯
ç¾åœ¨ç¶²ç«™æ­£åœ¨ä¿ƒéŠ·æ´»å‹•ï¼ŒPM å¸Œæœ›æˆ‘å€‘å¢åŠ ä¸€å€‹å€’æ•¸è¨Šæ¯çš„ç•«é¢
è¦æ ¹æ“šå¾Œå°è¨­å®šçš„æ™‚é–“å»è¨ˆç®—å‰©é¤˜çš„å¤©ã€æ™‚ã€åˆ†ã€ç§’ã€‚

ä¸€é–‹å§‹ï¼Œæˆ‘çš„å¯«æ³•æ˜¯é€™æ¨£çš„ï¼š

[click]
å…ˆè¨­å®šä¸€å€‹ state ä¸¦è®“ä»–åˆå§‹å€¼ç‚º 0 0 0 0

[click]
ç„¶å¾Œæˆ‘ç”¨ useEffect å»åœ¨çµ„ä»¶ mounted å¾Œå»è¨ˆç®—æ™‚é–“å·®ï¼Œä¸¦ç”¨ setTimeout æ¯ç§’æ›´æ–°ã€‚

åŠŸèƒ½ä¸Šæ˜¯æ­£å¸¸çš„ï¼Œä½†é€™æ¨£æœ‰ä¸€å€‹å•é¡Œã€‚
-->

---

# æ”¾å½±ç‰‡

å¯ä»¥ç™¼ç¾ç•«é¢ä¸€é–‹å§‹æœƒå‡ºç¾ä¸€é–ƒè€Œéçš„ã€Œ0 0 0 0ã€

<Video src="/ch-2/0-countdown.mp4" class="max-h-[400px]" />

<!--
å¯ä»¥ç™¼ç¾ç•«é¢ä¸€é–‹å§‹æœƒå‡ºç¾ä¸€é–ƒè€Œéçš„ã€Œ0 0 0 0ã€ï¼Œè »å¿«çš„è¦çœ‹ä»”ç´°ä¸€é»

é€™æ˜¯å› ç‚ºä¸ç®¡å¯¦éš›ä¸Šé‚„å‰©å¹¾å¤©ï¼Œåˆå§‹åŒ–å°±æ˜¯ 0ï¼Œæˆ‘ä¸å¸Œæœ›ä½¿ç”¨è€…ä¸€é–‹å§‹æ˜¯çœ‹åˆ° 0 0 0 0ã€‚
-->

---

# è§£æ³•ï¼šåˆ©ç”¨åˆå§‹åŒ–å‡½æ•¸(initial function)ç®—å‡ºåˆå§‹å€¼

éœ€è¦é å…ˆè¨ˆç®—åˆå§‹å€¼ &rarr; ä½¿ç”¨åˆå§‹åŒ–å‡½æ•¸ã€‚

````md magic-move
```jsx
function Countdown({ targetTime }) {
  const [timeLeft, setTimeLeft] = useState({
  days: 0,
  hours: 0,
  minutes: 0,
  seconds: 0
  });

  useEffect(() => {
    const timer = setInterval(() => {
      setTimeLeft(calculateTimeLeft(targetTime));
    }, 1000);

    return () => clearInterval(timer);
  }, [targetTime]);

  return ...
 }
```

```jsx {2}
function Countdown({ targetTime }) {
  const [timeLeft, setTimeLeft] = useState(() => calculateTimeLeft(targetTime));

  useEffect(() => {
    const timer = setInterval(() => {
      setTimeLeft(calculateTimeLeft(targetTime));
    }, 1000);

    return () => clearInterval(timer);
  }, [targetTime]);

  return ...
 }
```
````

<!--
é€™ç¨®éœ€è¦åˆå§‹å€¼æ˜¯å·²ç¶“è¨ˆç®—éçš„æƒ…æ³ï¼Œå…¶å¯¦å¯ä»¥åˆ©ç”¨ useState çš„åˆå§‹åŒ–å‡½æ•¸ï¼ˆinitial functionï¼‰ä¾†è™•ç†ã€‚

[click]
æŠŠ calculateTimeLeft ç§»åˆ° useState çš„åˆå§‹åŒ–å‡½æ•¸ä¸­ï¼Œé€™æ¨£ä¸€ä¾†ï¼ŒReact åœ¨ç¬¬ä¸€æ¬¡ render æ™‚å°±æœƒå¹«ä½ å…ˆç®—å‡ºåˆå§‹å€¼ï¼Œä¸æœƒå‡ºç¾ä¸€ç¬é–“ 0 0 0 0çš„ç•«é¢ã€‚
-->

---

# åˆå§‹åŒ–å‡½æ•¸çš„éŒ¯èª¤ç”¨æ³•

åˆå§‹åŒ–å‡½æ•¸é›–ç„¶å¾ˆå¥½ç”¨ï¼Œä½†ä¹Ÿè¦æ³¨æ„ä¸€å€‹éŒ¯èª¤çš„å¯«æ³•ï¼Œ**å°¤å…¶åœ¨éœ€è¦å‚³åƒæ•¸çš„æƒ…æ³ä¸‹**

````md magic-move
```jsx {2}
function Countdown({ targetTime }) {
  const [timeLeft, setTimeLeft] = useState(() => calculateTimeLeft(targetTime));

  useEffect(() => {
    const timer = setInterval(() => {
      setTimeLeft(calculateTimeLeft(targetTime));
    }, 1000);

    return () => clearInterval(timer);
  }, [targetTime]);

  return ...
 }
```

```jsx {2}
function Countdown({ targetTime }) {
  const [timeLeft, setTimeLeft] = useState(calculateTimeLeft(targetTime)); // âŒ éŒ¯èª¤ç”¨æ³•

  useEffect(() => {
    const timer = setInterval(() => {
      setTimeLeft(calculateTimeLeft(targetTime));
    }, 1000);

    return () => clearInterval(timer);
  }, [targetTime]);

  return ...
 }
```

```jsx {2-3}
function Countdown({ targetTime }) {
  const initVal = calculateTimeLeft(targetTime) // ğŸ‘ˆ æ¯æ¬¡ Re-render éƒ½æœƒåŸ·è¡Œ
  const [timeLeft, setTimeLeft] = useState(initVal);

  useEffect(() => {
    const timer = setInterval(() => {
      setTimeLeft(calculateTimeLeft(targetTime));
    }, 1000);

    return () => clearInterval(timer);
  }, [targetTime]);

  return ...
 }
```
````

<!--
åˆå§‹åŒ–å‡½æ•¸é›–ç„¶å¾ˆå¥½ç”¨ï¼Œä½†ä¹Ÿè¦æ³¨æ„ä¸€å€‹éŒ¯èª¤çš„å¯«æ³•ï¼Œå°¤å…¶åœ¨éœ€è¦å‚³åƒæ•¸çš„æƒ…æ³ä¸‹

åƒåœ¨å‰›å‰›ä¾‹å­ï¼Œæˆ‘éœ€è¦å‚³ targetTime çµ¦ calculateTimeLeftï¼Œ

[click]
ä½†å¦‚æœæˆ‘å€‘é€™æ¨£å¯«ï¼Œæœƒåœ¨æ¯æ¬¡ Re-render æ™‚åŸ·è¡Œ

[click]
å› ç‚ºä»–é¡ä¼¼é€™ç¨®å¯«æ³•ï¼Œé€™æ¨£å°±æœƒç…§æˆæ•ˆèƒ½çš„æµªè²»
-->

---

# åˆå§‹åŒ–å‡½æ•¸çš„æ­£ç¢ºç”¨æ³•

æ­£ç¢ºç”¨æ³•æ˜¯å–®ç´”å‚³å‡½æ•¸é€²å»å°±å¥½

````md magic-move
```jsx
const [timeLeft, setTimeLeft] = useState(calculateTimeLeft);
```

```jsx
// å¦‚æœéœ€è¦å‚³åƒæ•¸ï¼Œå¯ä»¥ä½¿ç”¨åŒ¿åå‡½æ•¸
const [timeLeft, setTimeLeft] = useState(() => calculateTimeLeft(targetTime));
```
````

<!--
æ­£ç¢ºç”¨æ³•æ˜¯å–®ç´”å‚³å‡½æ•¸é€²å»å°±å¥½

[click]
å¦‚æœåƒå‰›å‰›çš„éœ€æ±‚ä¸€æ¨£ï¼Œæˆ‘å€‘éœ€è¦å‚³åƒæ•¸çµ¦ä»–ï¼Œé€™ç¨®æ™‚å€™å°±å¯ä»¥ä½¿ç”¨åŒ¿åå‡½æ•¸ï¼Œåƒé€™æ¨£
-->

---
layout: center
---

# åˆå§‹åŒ–å‡½æ•¸ç”¨æ³•ç¸½çµ

ç™¼ç¾ç•«é¢<span v-mark="{color: 'var(--secondary)', at:1}">é–ƒäº†ä¸æ­£ç¢ºçš„å€¼</span>æˆ–<span v-mark="{color: 'var(--secondary)', at:2}"> useState çš„åˆå§‹å€¼éœ€è¦é å…ˆè¨ˆç®—</span> &rarr; æƒ³åˆ°åˆå§‹åŒ–å‡½æ•¸ `useState(calInitState)`

<v-click at="3">

éœ€è¦å‚³åƒæ•¸ &rarr; ä½¿ç”¨åŒ¿åå‡½æ•¸ `useState(() => calInitState(params))`

</v-click>

<!--
å¦‚æœä½ ç™¼ç¾ç•«é¢ä¸€é–‹å§‹

[click]
ã€Œé–ƒäº†ä¸€ä¸‹ä¸æ­£ç¢ºçš„å€¼ã€æˆ– 

[click]
useState éœ€è¦é å…ˆè¨ˆç®— -> æƒ³åˆ°åˆå§‹åŒ–å‡½æ•¸


[click]

å¦‚æœåˆå§‹åŒ–å‡½æ•¸è¦å¸¶åƒæ•¸ï¼Œä½¿ç”¨åŒ¿åå‡½æ•¸ `useState(() => calInitState(params))`

é€™å¯ä»¥é¿å…ç•«é¢åˆå§‹å€¼éŒ¯èª¤ï¼Œä¹Ÿèƒ½çœä¸‹æ¯æ¬¡ render çš„æ•ˆèƒ½æµªè²»

é€™å€‹æŠ€å·§åœ¨è™•ç†å€’æ•¸ã€é è¨­è³‡æ–™ã€æ™‚é–“å·®ç­‰æƒ…å¢ƒéƒ½éå¸¸å¥½ç”¨
-->

---

# ä¸‰ã€ç‰©ä»¶èˆ‡é™£åˆ—çš„ State é™·é˜±

å…ˆä¾†çœ‹ä¸€å€‹å ´æ™¯ï¼Œå‡è¨­æˆ‘å€‘æƒ³è¦åœ¨é»æ“ŠæŒ‰éˆ•æ™‚ï¼Œæ–°å¢ä¸€å€‹ç‰©å“

````md magic-move
```jsx
const [items, setItems] = useState(['A', 'B']);
```

```jsx
const [items, setItems] = useState(['A', 'B']);

const addItem = () => {
  items.push('C');
  setItems(items);
};
```

```jsx
const [items, setItems] = useState(['A', 'B']);

const addItem = () => {
  items.push('C'); // é‚„æ˜¯åŒä¸€ä»½è³‡æ–™
  setItems(items); // React ä¸æœƒ re-render
};
```
````

<!--
å¥½ï¼Œå‰é¢è¬›äº† derived state å’Œåˆå§‹åŒ–å‡½æ•¸çš„æŠ€å·§

æ¥ä¸‹ä¾†è¦è¬›ä¸€å€‹å¾ˆå¤šæ–°æ‰‹æœƒçŠ¯çš„éŒ¯èª¤ï¼Œå°±æ˜¯å° state ç‰©ä»¶ã€é™£åˆ—çš„èª¤è§£

å…ˆä¾†çœ‹ä¸€å€‹å ´æ™¯ï¼Œå‡è¨­æˆ‘å€‘æƒ³è¦åœ¨é»æ“ŠæŒ‰éˆ•æ™‚ï¼Œæ–°å¢ä¸€å€‹ç‰©å“
æ‰€ä»¥å¯«äº†é€™æ¨£çš„ç¨‹å¼ç¢¼

[click]
ä½†ä½ ç™¼ç¾ç›´æ¥ä¿®æ”¹é™£åˆ—æˆ–ç‰©ä»¶çš„å…§å®¹ï¼Œç•«é¢ä¸æœƒæ›´æ–°ã€‚

ä½ å¯èƒ½æœƒæƒ³ï¼šã€Œæˆ‘éƒ½å‘¼å« setItems äº†ï¼Œç‚ºä»€éº¼ç•«é¢æ²’æ›´æ–°ï¼Ÿä¸æ˜¯å‰é¢èªª setState æœƒ trigger re-render æµç¨‹å—ï¼Ÿã€

[click]
é€™æ˜¯å› ç‚º React èƒŒå¾Œæœ‰ä¸€å¥—å„ªåŒ–æ©Ÿåˆ¶ï¼šå¦‚æœå®ƒè¦ºå¾—ã€Œå€¼æ²’æœ‰è®Šã€ï¼Œå°±æœƒè·³éé‡æ–°æ¸²æŸ“ã€‚

é‚£æ€æ¨£å«åšã€Œå€¼æœ‰è®Šã€å‘¢ï¼ŸReact å…¶å¯¦ä¸æ˜¯æ¯”è¼ƒå…§å®¹æœ‰æ²’æœ‰è®Šï¼Œè€Œæ˜¯çœ‹ä½ çµ¦çš„æ˜¯ä¸æ˜¯å…¨æ–°çš„æ±è¥¿ã€‚

æ‰€ä»¥å¦‚æœæˆ‘å€‘åªæ˜¯ä¿®æ”¹åŸæœ¬é‚£ä»½è³‡æ–™ï¼ŒReact æœƒè¦ºå¾—ã€Œå€¼æ²’æœ‰è®Šã€ï¼Œæ‰€ä»¥ä¸æœƒé‡æ–°æ¸²æŸ“ã€‚
-->

---

# React æ ¸å¿ƒè§€å¿µ - immutable ä¸å¯è®Šè³‡æ–™

<v-click>

React é¼“å‹µç”¨ã€Œä¸å¯è®Šè³‡æ–™ï¼ˆimmutableï¼‰ã€çš„æ–¹å¼è™•ç†ç‹€æ…‹ï¼ˆstateï¼‰

</v-click>

<v-click>

ç‹€æ…‹æ˜¯**å”¯è®€çš„ï¼ˆread-onlyï¼‰ï¼Œä½ ä¸æ‡‰è©²ç›´æ¥ä¿®æ”¹å®ƒï¼Œè€Œæ˜¯è¦å‰µé€ ä¸€ä»½æ–°çš„è³‡æ–™ä¾†å–ä»£å®ƒã€‚**

```jsx
const [items, setItems] = useState(['A', 'B']);
items.push('C'); // é€™æ¨£åšæœƒè®“ React ç„¡æ³•å¯Ÿè¦ºè³‡æ–™æœ‰è®ŠåŒ–ã€‚
```

</v-click>

<v-click>

æˆ‘å€‘è¦åšçš„æ˜¯ï¼Œå»ºç«‹ä¸€ä»½æ–°çš„é™£åˆ—ï¼Œå†äº¤çµ¦ setItemsï¼š

```jsx
setItems((prev) => [...prev, 'C']); // å…ˆæŠŠèˆŠå…§å®¹å±•é–‹ï¼Œå†åŠ ä¸Šæ–°çš„ä¸€å€‹å€¼ï¼Œå‰µå»ºä¸€ä»½æ–°çš„é™£åˆ—
```

</v-click>

<v-click>

```jsx
const newItems = [...items, 'C'];
setItems(newItems);
```

</v-click>

<v-click>

Immutable çš„å¥½è™•æ˜¯ç©©å®šä¸”å¥½ç¶­è­·

å› ç‚ºè³‡æ–™ä¸æœƒè¢«éš¨æ„æ›´æ”¹ï¼Œ**ä»€éº¼æ™‚å€™è®€åˆ°å®ƒï¼Œå€¼éƒ½æ˜¯ä¸€æ¨£çš„ï¼Œé€™è®“é™¤éŒ¯å’Œè¿½è¹¤å•é¡Œè®Šå¾—æ›´ç°¡å–®**

</v-click>

<!--
é‚£é€™é‚Šå°±è¦è¬›ä¸€ä¸‹ React çš„æ ¸å¿ƒè§€å¿µ immutable äº†ã€‚

[click]

React é¼“å‹µä½ ç”¨ã€Œä¸å¯è®Šè³‡æ–™ï¼ˆimmutableï¼‰ã€çš„æ–¹å¼è™•ç†ç‹€æ…‹ï¼ˆstateï¼‰ã€‚
é€™å€‹åŸå‰‡ä¸»è¦æ˜¯ç‚ºäº†å¹«åŠ© React åˆ¤æ–·è³‡æ–™æ˜¯å¦è®Šå‹•ï¼Œé€²è€Œæ±ºå®šæ˜¯å¦éœ€è¦ re-renderã€‚

[click]

ç°¡å–®èªªï¼Œç‹€æ…‹æ˜¯å”¯è®€çš„ï¼ˆread-onlyï¼‰ï¼Œä½ ä¸æ‡‰è©²ç›´æ¥ä¿®æ”¹å®ƒï¼Œè€Œæ˜¯è¦å‰µé€ ä¸€ä»½æ–°çš„è³‡æ–™ä¾†å–ä»£å®ƒã€‚

[click]

æ‰€ä»¥æ­£ç¢ºçš„åšæ³•æ˜¯ï¼Œæˆ‘å€‘è¦å‰µé€ ä¸€å€‹æ–°çš„é™£åˆ—ï¼Œä¸¦ç”¨ setState æ›´æ–°ï¼Œä¸è¦ç›´æ¥æ”¹åŸæœ¬çš„ã€‚


é€™æ¨£ React å°±èƒ½å¾ˆå¿«åœ°çŸ¥é“ï¼šã€Œå•Šï¼Œè³‡æ–™è®Šäº†ï¼ã€ç„¶å¾Œè‡ªå‹•å¹«ä½ æ›´æ–°ç•«é¢ã€‚

é€™è¡Œçš„æ„æ€æ˜¯ï¼šå»ºç«‹ä¸€å€‹å…¨æ–°çš„é™£åˆ—ï¼Œå…§å®¹æ˜¯å…ˆæŠŠèˆŠçš„å±•é–‹ï¼ˆ...prevï¼‰ï¼Œå†åŠ ä¸Šæ–°çš„ä¸€å€‹å€¼ã€‚

[click]

é€™å…©å€‹å¯«æ³•æ˜¯ä¸€æ¨£çš„

[click]


å¾ˆå¤šæ–°æ‰‹æœƒè¦ºå¾—é€™æ¨£åšå¾ˆéº»ç…©ï¼Œä½†å…¶å¯¦é€™æ˜¯ React è¨­è¨ˆçš„ä¸€éƒ¨åˆ†ï¼š
Immutable çš„å¥½è™•æ˜¯ç©©å®šä¸”å¥½ç¶­è­·ã€‚

å› ç‚ºè³‡æ–™ä¸æœƒè¢«éš¨æ„æ›´æ”¹ï¼Œæ‰€ä»¥ä½ ä»€éº¼æ™‚å€™è®€åˆ°å®ƒï¼Œå€¼éƒ½æ˜¯ä¸€æ¨£çš„ï¼Œé€™è®“é™¤éŒ¯å’Œè¿½è¹¤å•é¡Œè®Šå¾—æ›´ç°¡å–®ã€‚
-->

---

# å…¶ä»–å¸¸è¦‹é™£åˆ—æ“ä½œ

<v-click>

å¦‚æœæƒ³å°ä¸€å€‹**é™£åˆ—ç‹€æ…‹**å»é€²è¡Œå¢åŠ ã€åˆªé™¤ã€ä¿®æ”¹ï¼Œå¿…é ˆ**ç”¨èƒ½è¿”å›é™£åˆ—çš„æ–¹æ³•**

</v-click>

<v-click>

åƒæ˜¯ `[...prev]`ã€`map`ã€`filter`ã€`reduce` è€Œä¸æ˜¯ `forEach`ã€`push`ã€`pop`ã€`shift` ç­‰æœƒç›´æ¥ä¿®æ”¹åŸæœ¬é™£åˆ—çš„æ–¹æ³•

```jsx
// æ–°å¢
setItems((prev) => [...prev, { id: 3, name: 'Cherry' }]);
// åˆªé™¤
setItems((prev) => prev.filter((item) => item.id !== 2));
// ä¿®æ”¹
setItems((prev) =>
  prev.map((item) => (item.id === 1 ? { ...item, name: 'Apple' } : item))
);
```

</v-click>

<!--
[click]

æ‰€ä»¥å¦‚æœæˆ‘å€‘æƒ³è¦å°ä¸€å€‹é™£åˆ—å»é€²è¡Œå¢åˆªæ”¹æŸ¥ï¼Œéƒ½å¿…é ˆç”¨èƒ½è¿”å›é™£åˆ—çš„æ–¹æ³•

[click]

åƒæ˜¯ å±•é–‹é‹ç®—å­ã€mapã€filterã€reduce è€Œä¸æ˜¯ forEachã€pushã€popã€shift ç­‰æœƒç›´æ¥ä¿®æ”¹åŸæœ¬é™£åˆ—çš„æ–¹æ³•
ä¸‹é¢æœ‰ä¸€äº›å¸¸è¦‹æ“ä½œé™£åˆ—çš„ç¤ºç¯„

æ–°å¢å°±æ˜¯ç”¨å±•é–‹é‹ç®—å­ä¾†è¿”å›æ–°çš„é™£åˆ—

åˆªé™¤å°±æ˜¯ç”¨ filter ä¾†è¿”å› id ä¸ç­‰æ–¼ 2 çš„ item

ä¿®æ”¹å°±æ˜¯ç”¨ map ä¾†æ‰¾åˆ°å°æ‡‰çš„ item ä¸¦ä¿®æ”¹ï¼Œå…¶ä»–ä¸ç›¸é—œçš„ item å°±ç›´æ¥è¿”å›åŸæœ¬çš„å€¼
-->

---

# ç‰©ä»¶èª¤å€ï¼šç›´æ¥æ”¹å±¬æ€§ä¸€æ¨£ä¸æœƒæ›´æ–°

è·Ÿé™£åˆ—ä¸€æ¨£ï¼Œç‰©ä»¶ä¹Ÿä¸èƒ½ç›´æ¥ä¿®æ”¹

```jsx
const [user, setUser] = useState({ name: 'ThisWeb', age: 50 });

const handleClick = () => {
  user.age = 51; // âŒ éŒ¯ï¼šç›´æ¥æ”¹ç‰©ä»¶
  setUser(user); // React ä¸æœƒ re-render
};
```

<v-click>

æ­£ç¢ºåšæ³•ï¼šå±•é–‹ç‰©ä»¶ã€å‰µé€ æ–°åƒè€ƒ

```jsx
setUser((prevUser) => ({
  ...prevUser,
  age: 26,
}));
```

</v-click>

<!--
è·Ÿé™£åˆ—ä¸€æ¨£ï¼Œç‰©ä»¶ä¹Ÿä¸èƒ½ç›´æ¥ä¿®æ”¹

åƒé€™è£¡ç›´æ¥ä¿®æ”¹ç‰©ä»¶çš„å±¬æ€§æ˜¯ä¸æœƒæœ‰æ•ˆæœçš„

[click]

æ­£ç¢ºåšæ³•ï¼šå±•é–‹ç‰©ä»¶ã€å‰µé€ æ–°åƒè€ƒ

é€™æ¨£ React æ‰æœƒçŸ¥é“ï¼šã€Œä½ å‚³é€²ä¾†çš„æ˜¯æ–°çš„ç‰©ä»¶ã€ï¼Œæ‰æœƒè§¸ç™¼æ›´æ–°ã€‚

ä½†å¦‚æœä½ çš„è³‡æ–™çµæ§‹è®Šå¾—æ¯”è¼ƒè¤‡é›œï¼Œåƒé€™æ¨£ï¼š
-->

---

# è¤‡é›œçš„å·¢ç‹€ç‰©ä»¶

ä½†å¦‚æœä½ çš„è³‡æ–™çµæ§‹è®Šå¾—æ¯”è¼ƒè¤‡é›œï¼Œåƒé€™æ¨£ï¼š

```jsx
const [user, setUser] = useState({
  name: 'Alice',
  address: {
    city: 'Taipei',
    zip: '100',
  },
});
```

<v-click>

```jsx
// æ›´æ–° User æ™‚è¦å±•é–‹å…©å±¤ç‰©ä»¶
setUser((prev) => ({
  ...prev, // ğŸ‘ˆ å±•é–‹ç¬¬ä¸€å±¤
  address: {
    ...prev.address, // ğŸ‘ˆ å±•é–‹ç¬¬äºŒå±¤
    city: 'Tainan',
  },
}));
```

</v-click>

<!--
ä½†å¦‚æœä½ çš„è³‡æ–™çµæ§‹è®Šå¾—æ¯”è¼ƒè¤‡é›œï¼Œåƒé€™æ¨£ï¼š

[click]
é‚£ä½ åœ¨æ›´æ–° city æ™‚ï¼Œå°±è¦é€™æ¨£å¯«æ‰å°

å…©å±¤éƒ½è¦ç”¨å±•é–‹é‹ç®—ç¬¦ä¾†è¿”å›å€¼ï¼Œå¦‚æœæ²’æœ‰ä½¿ç”¨ï¼Œæ•´å€‹ç‰©ä»¶æœƒç›´æ¥è¢«è¦†è“‹æ‰

ä½ æœƒç™¼ç¾é–‹å§‹æœ‰é»ç—›è‹¦äº†ï¼Œé€™ä¹Ÿæ˜¯ç‚ºä»€éº¼æˆ‘å€‘è¦è€ƒæ…® state çš„è¤‡é›œåº¦ï¼Œä¹Ÿæ˜¯ä¸‹å€‹ç« ç¯€çš„ä¸»é¡Œ
-->

---

# é‡é»è§€å¿µï¼šè€ƒæ…®å–®ä¸€ state çš„è¤‡é›œåº¦

å¦‚æœä½ çš„ state é•·é€™æ¨£ï¼š

````md magic-move
```jsx
const [user, setUser] = useState({
  user: {
    id: '',
    name: '',
    email: '',
    address: {
      city: '',
      geo: {
        lat: 0.0,
        lng: 0.0,
      },
    },
    preferences: {
      language: 'en',
      theme: 'light',
      notifications: {
        email: true,
        sms: false,
        push: true,
      },
    },
    status: {
      online: false,
      lastLogin: '',
    },
  },
});
```

```jsx
setUser((prev) => ({
  ...prev,
  user: {
    ...prev.user,
    preferences: {
      ...prev.user.preferences,
      notifications: {
        ...prev.user.preferences.notifications,
        email: false,
      },
    },
  },
}));
```
````

<v-click at="2">

**æ‰€ä»¥å¦‚ä½•ç®¡ç† state ä¹Ÿæ˜¯æŠŠç¨‹å¼å¯«å¥½çš„é—œéµ**ï¼Œä¹Ÿæ˜¯ä¸‹å€‹ç« ç¯€çš„ä¸»é¡Œ

</v-click>

<!--
æ‰€ä»¥èªªç•¶ä½ çš„ state è®Šè¤‡é›œæ™‚ï¼Œæˆ‘å€‘è¦æ€è€ƒèƒ½ä¸èƒ½é™ä½ state çš„è¤‡é›œåº¦ï¼Œä¸è¦è®“ state é›£ä»¥æ‹†è§£

é›–ç„¶åƒé€™æ¨£ã€Œå…¨éƒ¨å¡é€²ä¸€å€‹ stateã€å¥½åƒå¾ˆæ–¹ä¾¿å¯ä»¥çµ±ä¸€ç®¡ç†ï¼Œå¯ä»¥çœ‹åˆ°é€™å€‹ user state è£¡é¢æœ‰ä¸€å †è³‡æ–™

[click]
ä½†æ˜¯æ›´æ–°æ™‚è¦å¯«ä¸€é•·ä¸²å±•é–‹é‹ç®—å­ï¼Œå¾ˆé›£è¿½è¹¤æ˜¯å“ªå€‹æ¬„ä½è®Šäº†ï¼Œå¢åŠ ç¶­è­·æˆæœ¬

ä¾‹å¦‚æˆ‘è¦æ›´æ–° notifications çš„ email è®Š falseï¼Œå°±è¦å¯«é€™æ¨£ï¼Œéå¸¸å¤šçš„å±•é–‹é‹ç®—ç¬¦ï¼Œä¹Ÿéå¸¸é›£çœ‹

[click]
æ‰€ä»¥å¦‚ä½•ç®¡ç† state ä¹Ÿæ˜¯æŠŠç¨‹å¼å¯«å¥½çš„é—œéµï¼Œé€™ä¹Ÿæ˜¯æˆ‘å€‘ä¸‹å€‹ç« ç¯€çš„ä¸»é¡Œ (åˆ‡é é¢ )
-->

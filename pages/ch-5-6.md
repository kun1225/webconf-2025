
---
layout: center
transition: blur-in
---

<ThemeTitle number="5" class="text-6xl! leading-25!">
<div>å¦‚ä½•æ­£ç¢ºè¨­è¨ˆ Contextï¼Ÿ</div>
<div>Context é‡æ–°æ¸²æŸ“çš„çœŸç›¸</div>
</ThemeTitle>

<!--
åˆ°é€™å€‹ç« ç¯€ï¼Œä½ å·²ç¶“èƒ½è§£æ±ºçµ•å¤§éƒ¨åˆ† Re-render çš„å•é¡Œäº†ã€‚

ä¸éé‚„æœ‰ä¸€å€‹é™·é˜±æˆ‘å€‘é‚„æ²’è¬›åˆ°ï¼Œå°± context çš„é™·é˜±
-->

---
layout: center
---

# context çš„é™·é˜±

åªè¦æŸå€‹çµ„ä»¶ä½¿ç”¨äº† Contextï¼ˆä¹Ÿå°±æ˜¯æˆç‚º consumerï¼‰

ç„¡è«–å®ƒæ˜¯å¦çœŸæ­£å¯¦éš›ä½¿ç”¨åˆ° state

<span v-mark="{ color: 'var(--secondary)' }">åªè¦ context çš„æŸå€‹ state æ”¹è®Šäº†ï¼Œæ‰€æœ‰çš„ consumer å°±æœƒè¢«é‡æ–°æ¸²æŸ“</span>

<!--
åªè¦æŸå€‹çµ„ä»¶ä½¿ç”¨äº† Contextï¼ˆä¹Ÿå°±æ˜¯æˆç‚º consumerï¼‰ï¼Œç„¡è«–å®ƒæ˜¯å¦çœŸæ­£å¯¦éš›ä½¿ç”¨åˆ° state

[click]
åªè¦ context çš„æŸå€‹ state æ”¹è®Šäº†ï¼Œæ‰€æœ‰çš„ consumer å°±æœƒè¢«é‡æ–°æ¸²æŸ“ã€‚

é€™å€‹ç« ç¯€å°±è¦ä¾†å¥½å¥½è¬›é€™å€‹ Context çš„å•é¡Œä»¥åŠè©²å¦‚ä½•å„ªåŒ–å®ƒã€‚
-->

---

# context çš„é™·é˜±

````md magic-move {lines: true}
```jsx {*|1|3-11|13-17}
const CountContext = createContext();

function CountProvider({ children }) {
  const [count, setCount] = useState(0);

  return (
    <CountContext.Provider value={{ count, setCount }}>
      {children}
    </CountContext.Provider>
  );
}

function useCount() {
  const context = useContext(CountContext);

  if (!context) throw new Error('useCount must be used within a CountProvider');
  return context;
}
```

```jsx {*|4,12-16|5,18-21,6,24-28|7,30-33}
export default function Page() {
  return (
    <CountProvider>
      <ComponentA />
      <ComponentB />
      <ComponentC />
      <ComponentD />
    </CountProvider>
  );
}

function ComponentA() {
  console.log('Re-Render ComponentA');
  const { count } = useCount();
  return <div>{count}</div>;
}

function ComponentB() {
  console.log('Re-Render ComponentB');
  const { setCount } = useCount();
  return <button onClick={() => setCount((prev) => prev + 1)}>+1</button>;
}

function ComponentC() {
  console.log('Re-Render ComponentC');
  const { setCount } = useCount();
  return <button onClick={() => setCount((prev) => prev + 2)}>+2</button>;
}

function ComponentD() {
  console.log('Re-Render ComponentD');
  return <div>ComponentD</div>;
}
```
````

<!--
æˆ‘å€‘å…ˆä¾†å¿«é€Ÿçœ‹ä¸€ä¸‹ç¨‹å¼ç¢¼ã€‚

[click]
åŸºæœ¬ä¸Šå°±æ˜¯ä¸€å€‹ context

[click]
é€™å€‹ Provider è£¡é¢æœ‰ä¸€å€‹ count state

[click]
æ¥è‘—ç”¨ä¸€å€‹ custom hook ä¾†ä½¿ç”¨é€™å€‹ context

[click]
ç„¶å¾Œæœ‰å¤šå€‹ component éƒ½ç”¨äº†é€™å€‹ hook ä¾†ä½¿ç”¨ context

[click]
componentA ç”¨åˆ°äº† state

[click]
component b c åªæ˜¯ç”¨ setCountï¼Œä¸¦æ²’æœ‰çœŸçš„ä½¿ç”¨åˆ° state

[click]
componentD å‰‡æ˜¯å®Œå…¨æ²’ç”¨åˆ° state
-->

---

# èª°æœƒè¢«é‡æ–°æ¸²æŸ“ï¼Ÿ

<Video src="/ch-3/2-context.mp4" />

<!--
æˆ‘å€‘ä¾†çŒœçŒœçœ‹èª°æœƒè¢«é‡æ–°æ¸²æŸ“

ç­”æ¡ˆæ˜¯ component a b c

a ç®—åˆç†ï¼Œå› ç‚ºä»–ç”¨åˆ°äº† count state

ä½† b c éƒ½åªæ˜¯ç”¨åˆ° setCountï¼Œæ²’æœ‰ç”¨åˆ° count æœ¬èº«ï¼Œç†è«–ä¸Šï¼Œä»–ä¸æ‡‰è©²è¢«é‡æ–°æ¸²æŸ“

é€™å€‹ä¾‹å­åªæ˜¯ä¸€å€‹ Demoï¼Œæˆ‘å€‘ä¾†çœ‹çœ‹æ›´å¯¦éš›çš„å ´æ™¯
-->

---

# å¯¦éš›çš„å ´æ™¯

````md magic-move {lines: true}
```jsx {*|2,9|3,11|4,12|5,13|15-19}
const MenuContext = createContext({
  isOpen: false,
  openMenu: () => {},
  closeMenu: () => {},
  toggleMenu: () => {},
});

function MenuProvider({ children }) {
  const [isOpen, setIsOpen] = useState(false);

  const openMenu = () => setIsOpen(true);
  const closeMenu = () => setIsOpen(false);
  const toggleMenu = () => setIsOpen((prev) => !prev);

  return (
    <MenuContext.Provider value={{ isOpen, openMenu, closeMenu, toggleMenu }}>
      {children}
    </MenuContext.Provider>
  );
}
```

```jsx {15-19}
const MenuContext = createContext({
  isOpen: false,
  openMenu: () => {},
  closeMenu: () => {},
  toggleMenu: () => {},
});

function MenuProvider({ children }) {
  const [isOpen, setIsOpen] = useState(false);

  const openMenu = () => setIsOpen(true);
  const closeMenu = () => setIsOpen(false);
  const toggleMenu = () => setIsOpen((prev) => !prev);

  return (
    <MenuContext value={{ isOpen, openMenu, closeMenu, toggleMenu }}>
      {children}
    </MenuContext>
  );
}
```

```jsx {2}
function MenuToggleButton() {
  const { toggleMenu } = useMenu();
  console.log('Re-Render MenuToggleButton');
  return <button onClick={toggleMenu}>Toggle</button>;
}
```
````

<!--
æˆ‘å€‘çœ‹ä¸€å€‹å¯¦éš›çš„ä¾‹å­

å‡è¨­ï¼Œç¾åœ¨æœ‰ä¸€å€‹ menu contextï¼Œè£¡é¢æœ‰ 

[click]
isOpen state

[click]
open

[click]
close

[click]
toggle é€™äº›å‡½æ•¸

[click]
å› ç‚ºé€™å€‹å°ˆæ¡ˆæœƒå†å¤šå€‹åœ°æ–¹å»æ§åˆ¶ Menu çš„å±•é–‹æˆ–é—œé–‰ï¼Œæ‰€ä»¥æœ€å¾Œç”¨ Provider æä¾›å…¨å±€ç‹€æ…‹å’Œå‡½æ•¸ã€‚

[click]
é¡Œå¤–è©±ä¸€ä¸‹ï¼Œå¦‚æœä½ ä½¿ç”¨ React 19 çš„è©±ï¼Œé€™é‚Šå¯ä»¥çœç•¥ .provider çš„å¯«æ³•ï¼Œæˆ‘å€‘é‚„æ˜¯å…ˆä»¥èˆŠçš„å¯«æ³•ç‚ºä¸»

[click]
æ¥è‘—ï¼Œåœ¨æŸå€‹å­çµ„ä»¶ä¸­åªä½¿ç”¨äº† toggleMenuï¼Œæˆ‘å€‘çŸ¥é“ç•¶ä»»ä½•çš„ state æ”¹è®Šæ™‚ï¼Œé€™å€‹çµ„ä»¶ä¹Ÿæœƒè¢« re-render
-->

---

<Video src="/ch-5/5-5/0.mp4" />

<!--
å¯ä»¥çœ‹åˆ° MenuToggleButton ä¹Ÿ re-render äº†ï¼Œé€™å°±æ˜¯æˆ‘å€‘è¦è§£æ±ºçš„å•é¡Œ
-->

---

# å˜—è©¦è§£æ³•ï¼šç”¨ useCallback ç©©å®šå‡½æ•¸åƒè€ƒ

````md magic-move {lines: true}
```jsx {4-8}
function MenuProvider({ children }) {
  const [isOpen, setIsOpen] = useState(false);

  // ğŸ‘‡ ä¸ä¾è³´ä»»ä½•ç‹€æ…‹
  const openMenu = () => setIsOpen(true);
  const closeMenu = () => setIsOpen(false);
  const toggleMenu = () => setIsOpen((prev) => !prev);

  return (
    <MenuContext.Provider value={{ isOpen, openMenu, closeMenu, toggleMenu }}>
      {children}
    </MenuContext.Provider>
  );
}
```

```jsx {4-8|10}
function MenuProvider({ children }) {
  const [isOpen, setIsOpen] = useState(false);

  // ğŸ‘‡ ä¸ä¾è³´ä»»ä½•æ±è¥¿ï¼Œæ°¸é ä¸æœƒæ”¹è®Š
  const openMenu = useCallback(() => setIsOpen(true), []);
  const closeMenu = useCallback(() => setIsOpen(false), []);
  const toggleMenu = useCallback(() => setIsOpen((prev) => !prev), []);

  return (
    <MenuContext.Provider value={{ isOpen, openMenu, closeMenu, toggleMenu }}>
      {children}
    </MenuContext.Provider>
  );
}
```
````

<!--
ä½ å¯èƒ½æœƒæƒ³ï¼šé€™äº›å‡½æ•¸çœ‹èµ·ä¾†ä¸ä¾è³´å¤–éƒ¨è®Šæ•¸

[click]
é‚£æˆ‘å€‘å¯ä¸å¯ä»¥æŠŠå®ƒå€‘ç”¨ useCallback åŒ…èµ·ä¾†ï¼Œä½¿å®ƒå€‘åœ¨è¨˜æ†¶é«”ä¸­ç©©å®šï¼Ÿ

æˆ‘å€‘æƒ³ 5 ç§’

[click]

äº‹å¯¦ä¸Šæ˜¯è¡Œä¸é€šçš„å“¦ï¼Œä¸€æ¨£æ˜¯åƒè€ƒå€¼çš„å•é¡Œï¼Œå› ç‚º provider value æ˜¯ä¸€å€‹ç‰©ä»¶ï¼Œæ‰€ä»¥æ¯æ¬¡ re-render æ™‚ä»–éƒ½æ˜¯æ–°çš„åƒè€ƒå€¼
-->

---

# å˜—è©¦è§£æ³•ï¼šuseMemo

````md magic-move
```jsx {8-15}
function MenuProvider({ children }) {
  const [isOpen, setIsOpen] = useState(false);

  const openMenu = () => setIsOpen(true);
  const closeMenu = () => setIsOpen(false);
  const toggleMenu = () => setIsOpen((prev) => !prev);

  const contextValue = useMemo(() => {
    return {
      isOpen,
      openMenu,
      closeMenu,
      toggleMenu,
    };
  }, []);

  return (
    <MenuContext.Provider value={contextValue}>{children}</MenuContext.Provider>
  );
}
```

```jsx {8-15}
function MenuProvider({ children }) {
  const [isOpen, setIsOpen] = useState(false);

  const openMenu = () => setIsOpen(true);
  const closeMenu = () => setIsOpen(false);
  const toggleMenu = () => setIsOpen((prev) => !prev);

  const contextValue = useMemo(() => {
    return {
      isOpen,
      openMenu,
      closeMenu,
      toggleMenu,
    };
  }, [isOpen]);

  return (
    <MenuContext.Provider value={contextValue}>{children}</MenuContext.Provider>
  );
}
```
````

<!--
é‚£æ ¹æ“šå‰é¢èªªçš„ï¼Œæˆ‘å€‘è¦è¨˜æ†¶åŒ–ä¸€å€‹ç‰©ä»¶ï¼Œæ˜¯ä¸æ˜¯è¦ä½¿ç”¨ useMemoï¼Œæ‰€ä»¥æˆ‘å€‘å˜—è©¦å¦ä¸€å€‹è§£æ³•ï¼Œæˆ‘å€‘ç”¨ useMemo å°‡ context çš„ value åŒ…èµ·ä¾†

ä½ å€‘è¦ºå¾—é€™å€‹è§£æ³•å¯ä»¥å—ï¼Ÿæƒ³ä¸€ä¸‹

äº‹å¯¦ä¸Šæ˜¯å¯ä»¥çš„å“¦ï¼Œçµ‚æ–¼æœ‰ä¸€å€‹å¯è¡Œçš„åšæ³•äº†ï¼¸ï¼¤

é€™ä¹Ÿå¾ˆç¬¦åˆé‚è¼¯ï¼Œå› ç‚ºåƒè€ƒå€¼è¢«è¨˜æ†¶åŒ–ï¼Œå°±ä¸æœƒ Re-render äº†ã€‚

ä½†é€™æ¨£æœƒæœ‰å€‹å•é¡Œï¼Œå› ç‚ºç‹€æ…‹éƒ½è¢«è¨˜æ†¶è‘—ï¼Œæˆ‘å€‘æœƒæ²’è¾¦æ³•åµæ¸¬åˆ° isOpen çš„æ”¹è®Šã€‚å°è‡´ä½¿ç”¨ isOpen çš„çµ„ä»¶æ²’è¾¦æ³•è¢«æ­£ç¢ºçš„é‡æ–°æ¸²æŸ“ï¼Œé¡¯ç¤ºæ–°çš„å€¼ã€‚

[click]
é‚£å¦‚æœæˆ‘å€‘æŠŠ isOpen æ”¾é€²ä¾è³´é™£åˆ—å‘¢ï¼Ÿ

é€™åˆæœƒå°è‡´è¨˜æ†¶åŒ–æœƒå¤±æ•ˆï¼Œå› ç‚º isOpen ç‹€æ…‹æ¯æ¬¡æ”¹è®Šæ™‚ï¼Œéƒ½æœƒç”¢ç”Ÿæ–°çš„åƒè€ƒå€¼ï¼Œå°è‡´ é‚£äº›æ²’æœ‰ç”¨åˆ° state çš„ consumer ä¸€æ¨£è¢«é‡æ–°æ¸²æŸ“ã€‚
-->

---

# æ­£ç¢ºè§£æ³•ï¼šæ‹†åˆ† Providers

ä¸€å€‹å„²å­˜æœƒè®Šå‹•çš„ stateï¼ˆä¾‹å¦‚ isOpenï¼‰ä¸€å€‹å„²å­˜ä¸æœƒè®Šå‹•çš„å‡½æ•¸ APIï¼ˆä¾‹å¦‚ openMenu, closeMenu, toggleMenuï¼‰

````md magic-move {lines: true}
```jsx
const MenuDataContext = createContext({
  isOpen: false,
});

const MenuApiContext = createContext({
  openMenu: () => {},
  closeMenu: () => {},
  toggleMenu: () => {},
});
```

```jsx {8,10-14}
function MenuProvider({ children }) {
  const [isOpen, setIsOpen] = useState(false);

  const openMenu = () => setIsOpen(true);
  const closeMenu = () => setIsOpen(false);
  const toggleMenu = () => setIsOpen((prev) => !prev);

  const api = { openMenu, closeMenu, toggleMenu };

  return (
    <MenuDataContext.Provider value={{ isOpen }}>
      <MenuApiContext.Provider value={api}>{children}</MenuApiContext.Provider>
    </MenuDataContext.Provider>
  );
}
```

```jsx {4-11|2,14|4-11,15}
function MenuProvider({ children }) {
  const [isOpen, setIsOpen] = useState(false);

  const openMenu = useCallback(() => setIsOpen(true), []);
  const closeMenu = useCallback(() => setIsOpen(false), []);
  const toggleMenu = useCallback(() => setIsOpen((prev) => !prev), []);

  const api = useMemo(
    () => ({ openMenu, closeMenu, toggleMenu }),
    [closeMenu, openMenu, toggleMenu]
  );

  return (
    <MenuDataContext.Provider value={{ isOpen }}>
      <MenuApiContext.Provider value={api}>{children}</MenuApiContext.Provider>
    </MenuDataContext.Provider>
  );
}
```
````

<!--
ä¸éæˆ‘å€‘å·²ç¶“è¶Šä¾†è¶Šæ¥è¿‘æ­£ç¢ºç­”æ¡ˆäº†ï¼Œ

æˆ‘å€‘çŸ¥é“ useMemo æ˜¯æœ‰ç”¨çš„ï¼Œä¸”åªæœ‰ isOpen ä¸ç”¨è¢«è¨˜æ†¶åŒ–ã€‚

é‚£æˆ‘å€‘æ˜¯ä¸æ˜¯å¯ä»¥æ‹†æˆ 2 å€‹ provider å‘¢ï¼Ÿ

ä¸€å€‹å„²å­˜æœƒè®Šå‹•çš„ stateï¼ˆä¾‹å¦‚ isOpenï¼‰

ä¸€å€‹å„²å­˜ä¸æœƒè®Šå‹•çš„å‡½æ•¸ APIï¼ˆä¾‹å¦‚ openMenu, closeMenu, toggleMenuï¼‰

é€™æ¨£çµ„ä»¶å°±åªæœƒå› è‡ªå·±å¯¦éš›é—œå¿ƒçš„éƒ¨åˆ†ç™¼ç”Ÿè®ŠåŒ–è€Œ re-renderã€‚

é¦¬ä¸Šä¾†è©¦è©¦çœ‹ï¼Œæˆ‘å€‘å…ˆå»ºç«‹å…©å€‹ Contextï¼šä¸€å€‹ç”¨ä¾†å„²å­˜æœƒæ”¹è®Šçš„å€¼ï¼Œå¦ä¸€å€‹ç”¨ä¾†å„²å­˜ä¸æœƒæ”¹è®Šçš„å€¼ã€‚


[click]
åœ¨ MenuProvider ä¸­ï¼Œæˆ‘å€‘ä¸å†åªä½¿ç”¨ä¸€å€‹æä¾›è€…ï¼Œè€Œæ˜¯ä½¿ç”¨å…©å€‹ï¼š

[click]
æ¥è‘—å°‡æ‰€æœ‰çš„åƒè€ƒå€¼ç”¨ useCallback å’Œ useMemo åŒ…èµ·ä¾†

[click]
é€™è£¡çš„é—œéµåœ¨æ–¼ï¼š

MenuDataContext.Provider åªåœ¨ isOpen æ”¹è®Šæ™‚æ›´æ–°

[click]
MenuApiContext.Provider æä¾›çš„å‡½æ•¸æ˜¯é€é useCallback å’Œ useMemo è¨˜æ†¶åŒ–çš„ï¼Œä¸æœƒéš¨è‘— state è®Šå‹•è€Œæ”¹è®Š

è¦æ³¨æ„ï¼Œé€™è£¡çš„ api ä¸€å®šè¦ç”¨ useMemo åŒ…èµ·ä¾†ï¼Œä¸èƒ½å¯«æˆ inline objectï¼Œä¸ç„¶ re-renderï¼Œinline object éƒ½æœƒæ˜¯æ–°çš„
-->

---

<Video src="/ch-5/5-5/1.mp4" />

<!--
æˆ‘å€‘ä¾†çœ‹çœ‹æ•ˆæœ

å¯ä»¥ç™¼ç¾ ToggleButton ä¸æœƒ re-render äº†ï¼Œé€™å°±æ˜¯æˆ‘å€‘è¦çš„æ•ˆæœ
-->

---

# æ‹†åˆ† Providers çš„é™åˆ¶

````md magic-move {lines: true}
```jsx
const toggleMenu = useCallback(() => setIsOpen((prev) => !prev), []);
```

```jsx
const toggleMenu = useCallback(() => setIsOpen(!isOpen), [isOpen]);

const api = useMemo(
  () => ({ openMenu, closeMenu, toggleMenu }),
  [closeMenu, openMenu, toggleMenu]
);

return (
  <MenuDataContext.Provider value={{ isOpen }}>
    {/* ğŸ‘‡ isOpen æ”¹è®Š -> toggleMenu æ”¹è®Š -> api æ”¹è®Š -> ApiContext é‡æ¸²æŸ“ */}
    <MenuApiContext.Provider value={api}>{children}</MenuApiContext.Provider>
  </MenuDataContext.Provider>
);
```

```jsx
const api = useMemo(() => ({ openMenu, closeMenu }), [closeMenu, openMenu]);

return (
  <MenuDataContext.Provider value={{ isOpen, toggleMenu }}>
    <MenuApiContext.Provider value={api}>{children}</MenuApiContext.Provider>
  </MenuDataContext.Provider>
);
```
````

<!--
é›–ç„¶æˆ‘å€‘å¯ä»¥é€éã€Œæ‹†åˆ† Provider Providersã€è®“è³‡æ–™èˆ‡æ“ä½œåˆ†é›¢ï¼Œä¾†æœ‰æ•ˆæ¸›å°‘ä¸å¿…è¦çš„ re-renderï¼Œä½†é€™å€‹æ¨¡å¼æœ‰ä¸€å€‹æ½›åœ¨å•é¡Œï¼š

[click]
ç•¶æ“ä½œå‡½æ•¸æœ¬èº«éœ€è¦ä¾è³´ç‹€æ…‹æ™‚ï¼Œè¨˜æ†¶åŒ–å°±æœƒå¤±æ•ˆã€‚

æ¯”å¦‚èªª toggleMenu é€™å€‹å‡½æ•¸ï¼Œå¦‚æœéœ€è¦ä¾è³´ç‹€æ…‹å‘¢ï¼Ÿ

é€™æ™‚å€™ï¼Œæ¯ç•¶ isOpen æ”¹è®ŠtoggleMenu å‡½æ•¸å°±æœƒè·Ÿè‘—æ›´æ–°ï¼Œå› æ­¤å‚³é MenuApiContext.Provider çš„ value ç‰©ä»¶ä¹Ÿæœƒæ”¹è®Šï¼š

çµæœæ˜¯ï¼šä½¿ç”¨ useContext(MenuApiContext) çš„çµ„ä»¶ä»ç„¶æœƒ Re-render

ç•¶ç„¶ï¼Œé€™å€‹ä¾‹å­æ˜¯å¯ä»¥ç”¨ updater function ä¾†è§£æ±ºï¼Œå°±åƒä¸€é–‹å§‹ç”¨ prev çš„æ–¹å¼ï¼Œä¸éå¦‚æœä»–æœƒä¾è³´å…¶ä»– state å°±æ²’è¾¦æ³•äº†ã€‚

[click]
é€™æ˜¯æ™‚å¯èƒ½æœ‰äººæœƒèªªï¼ŒæŠŠ toggleMenu æ”¾é€² MenuDataContext ä¾†é¿å…å…¶ä»– Api è¢«å½±éŸ¿å‘¢ï¼Ÿ

å°±åƒé€™æ¨£ï¼ŒæŠŠ toggleMenu å¾ api ä¸­ç§»é™¤ï¼Œä¸¦ä¸”æ”¾é€² MenuDataContext ä¸­ï¼š

æ˜¯å¯ä»¥ï¼Œä½†éå¸¸å¥‡æ€ªï¼Œå› ç‚º toggleMenu æ˜¯ä¸€å€‹ã€Œæ“ä½œã€ è€Œä¸æ˜¯è³‡æ–™ï¼ŒæŠŠå®ƒæ”¾é€² DataContext ä¸­é•åäº†é—œæ³¨é»åˆ†é›¢çš„åŸå‰‡ï¼Œä¹Ÿæœƒè®“çµæ§‹æ··äº‚ã€‚
-->

---

# è§£æ³•ï¼šå¼•å…¥ Reducer æ¨¡å¼

useReducer è®“æˆ‘å€‘å¯ä»¥å°‡ç‹€æ…‹é‚è¼¯æŠ½é›¢å‡ºä¾†ï¼Œä¸ç”¨é—œå¿ƒç´°ç¯€

````md magic-move
```jsx
const [isOpen, setIsOpen] = useState(false);

const openMenu = useCallback(() => setIsOpen(true), []);
const closeMenu = useCallback(() => setIsOpen(false), []);
const toggleMenu = useCallback(() => setIsOpen(!isOpen), [isOpen]); // ğŸ‘ˆ ä¾è³´ç‹€æ…‹
```

```jsx
const [state, dispatch] = useReducer(reducer, { isOpen: false });

const openMenu = () => dispatch({ type: 'open' });
const closeMenu = () => dispatch({ type: 'close' });
const toggleMenu = () => dispatch({ type: 'toggle' });
```

```jsx
const [state, dispatch] = useReducer(reducer, { isOpen: false });

const api = useMemo(
  () => ({
    openMenu: () => dispatch({ type: 'open' }),
    closeMenu: () => dispatch({ type: 'close' }),
    toggleMenu: () => dispatch({ type: 'toggle' }),
  }),
  []
);
```
````

<!--
é€™æ™‚ï¼Œæˆ‘å€‘å¯ä»¥ä¾é  Reducer ä¾†è§£æ±ºé€™å€‹å•é¡Œï¼šuseReducer å¯ä»¥è®“æˆ‘å€‘å°‡ç‹€æ…‹é‚è¼¯æŠ½é›¢å‡ºä¾†ï¼Œä¸ç”¨é—œå¿ƒç´°ç¯€ï¼Œåªè¦ä½¿ç”¨ dispatch å‘Šè¨´ä»–æˆ‘å€‘è¦åšä»€éº¼æ“ä½œå°±å¥½ã€‚

åŸæœ¬çš„å¯«æ³•æ˜¯é€™æ¨£ï¼š

[click]
æˆ‘å€‘æ”¹æˆ Reducer å¯«æ³•ï¼š

å¯ä»¥ç™¼ç¾æˆ‘å€‘å®Œå…¨ä¸æœƒä¾è³´ä»»ä½•ç‹€æ…‹äº†ï¼Œåªè¦ç”¨ dispatch å‚³éå‹•ä½œå°±å¥½

[click]
é€™æ¨£æˆ‘å€‘å°±å¯ä»¥æ”¾å¿ƒä½¿ç”¨ useMemo åŒ…èµ·ä¾†äº†ï¼Œæ˜¯ä¸€å€‹éå¸¸ç´°ç¯€çš„ç”¨æ³•
-->

---

# ä½¿ç”¨ useReducer çš„å¥½è™•

```jsx
const [state, dispatch] = useReducer(reducer, { isOpen: false });

const api = useMemo(
  () => ({
    openMenu: () => dispatch({ type: 'open' }),
    closeMenu: () => dispatch({ type: 'close' }),
    toggleMenu: () => dispatch({ type: 'toggle' }),
  }),
  []
);
```

<v-clicks>

1. ç¶­æŒã€Œæ‹†åˆ† providerã€çš„æ•ˆèƒ½å„ªå‹¢
2. ç‹€æ…‹é‚è¼¯é›†ä¸­åœ¨ reducerï¼Œç¶­è­·æ€§æ›´å¥½
3. æ‰€æœ‰ API å‡½æ•¸éƒ½ä¸å†ä¾è³´ç•¶å‰ç‹€æ…‹

</v-clicks>

<!--
[click]
1. ç¶­æŒã€Œæ‹†åˆ† providerã€çš„æ•ˆèƒ½å„ªå‹¢

[click]
2. ç‹€æ…‹é‚è¼¯é›†ä¸­åœ¨ reducerï¼Œç¶­è­·æ€§æ›´å¥½
   
[click]
3. æ‰€æœ‰ API å‡½æ•¸éƒ½ä¸å†ä¾è³´ç•¶å‰ç‹€æ…‹
-->

---

# reducer å¯¦ä½œç´°ç¯€

````md magic-move {lines: true}
```jsx
const reducer = (state, action) => {
  switch (action.type) {
    case 'open':
      return { ...state, isOpen: true };
    case 'close':
      return { ...state, isOpen: false };
    case 'toggle':
      return { ...state, isOpen: !state.isOpen };
    default:
      return state;
  }
};
```

```jsx
const reducer = (state, action) => {
  switch (action.type) {
    case 'open':
      return { ...state, isOpen: true };
    case 'close':
      return { ...state, isOpen: false };
    case 'toggle':
      return { ...state, isOpen: !state.isOpen };
    default:
      return state;
  }
};

function MenuProvider({ children }) {
  const [state, dispatch] = useReducer(reducer, { isOpen: false });

  const api = useMemo(
    () => ({
      openMenu: () => dispatch({ type: 'open' }),
      closeMenu: () => dispatch({ type: 'close' }),
      toggleMenu: () => dispatch({ type: 'toggle' }),
    }),
    []
  );

  return (
    <MenuDataContext.Provider value={state}>
      <MenuApiContext.Provider value={api}>{children}</MenuApiContext.Provider>
    </MenuDataContext.Provider>
  );
}
```
````

<!--
reducer çš„æ™‚ä½œä¹Ÿå¾ˆç°¡å–®ï¼Œåªè¦æ ¹æ“š action.type ä¾†æ±ºå®šè¦å›å‚³ä»€éº¼æ¨£çš„ state å°±å¥½ï¼Œå°±åƒç¨‹å¼ç¢¼é€™æ¨£

[click]
æœ€å¾Œé™„ä¸Šæ•´åˆ reducer çš„ MenuProvider
-->

---
layout: center
---

# å°ç¸½çµ

<v-clicks>

åªæœ‰ç°¡å–®çš„é–‹é—œ &rarr; `useState`

æ“ä½œå‡½æ•¸ä¾è³´ç‹€æ…‹ï¼Œä¸”è¦è¨˜æ†¶åŒ– &rarr; `useReducer`

ä¸ç”¨éæ—©çš„å„ªåŒ–

æˆ‘å€‘é‚„æ˜¯è¦æœƒé€™äº›å„ªåŒ–æ–¹å¼ï¼Œ**é‡åˆ°å•é¡Œæ™‚å°±èƒ½ä¸»å‹•æå‡ºè§£æ±ºè¾¦æ³•**

</v-clicks>

<!--
æœ€å¾Œç¸½çµä¸€ä¸‹

[click]
å¦‚æœä½ çš„ç‹€æ…‹å¾ˆç°¡å–®ï¼Œåƒä¸Šé¢é€™æ¨£åªæœ‰ç°¡å–®çš„é–‹é—œï¼Œé‚£éº¼ useState å°±è¶³å¤ äº†

[click]
å¦‚æœä½ çš„æ“ä½œå‡½æ•¸ä¾è³´ç‹€æ…‹ï¼Œä¸”è¦è¨˜æ†¶åŒ–ï¼Œé‚£å°±è¦ä½¿ç”¨ useReducer 

[click]
æœ€å¾Œï¼Œé›–ç„¶é€™å€‹ç« ç¯€è¬›äº†éå¸¸å¤šçš„å„ªåŒ–æŠ€å·§ï¼Œä½†æˆ‘å€‘åœ¨å¯«ç¨‹å¼æ™‚ï¼Œé‚„æ˜¯ä¸æ‡‰è©²éæ—©çš„å„ªåŒ–ï¼ŒèŠ±å¤ªå¤šæ™‚é–“åœ¨é€™é‚Š

[click]
ä¸éæˆ‘å€‘é‚„æ˜¯è¦æœƒé€™äº›å„ªåŒ–æ–¹å¼ï¼Œé€™æ¨£ç•¶ä½ çœŸçš„é‡åˆ°å•é¡Œæ™‚ï¼Œä½ æ‰èƒ½å¤ é¦¬ä¸Šæƒ³åˆ°è§£æ±ºæ–¹æ³•ä¸»å‹•æå‡ºï¼Œé€™ä¹Ÿæ˜¯å’Œåˆ¥äººæ‹‰é–‹å·®è·çš„åœ°æ–¹ã€‚
-->
